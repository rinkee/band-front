# 프론트 매쳐 사용법 (Just Scan Extension)

목표: 댓글을 가볍게 분석해 “추천 상품 + 수량” 미리보기를 만들고, 상품별 예상 수량을 빠르게 집계합니다. 확정은 서버에서 재검증 후 저장하세요.

## 설치/위치

- 경로: `just-scan-extension/func/client-matcher/`
- 파일:
  - `index.ts`: 공개 API (분석/집계)
  - `similarity.ts`: 브라우저 안전 유사도 유틸

빌드/실행은 기존 확장 빌드에 자동 포함됩니다.

## 타입

```ts
type ClientMatcherProduct = {
  itemNumber?: number;    // 없으면 index+1 사용
  title?: string | null;  // 상품명
  name?: string | null;   // 대체 상품명
  quantityText?: string | null; // 예: "1개", "1박스", "5kg" (선택)
  price?: number | null;
  keywords?: string[] | null; // 선택: 키워드/별칭(정확도 향상)
};

type ClientMatcherSuggestion = {
  itemNumber: number;
  productName: string;
  quantity: number;
  confidence: number;   // 0..1
  reason?: string;      // 매칭 근거
  matchMethod?: string; // number-based | product-name | unit-pattern | simple-number
};
```

## 기본 사용 예시 (단일 댓글)

```ts
import { analyzeComment } from '../func/client-matcher';

const products = [
  { itemNumber: 1, title: '브로콜리 1개', quantityText: '1개', keywords: ['브로컬리'] },
  { itemNumber: 2, title: '토마토 1박스', quantityText: '1박스' },
  { itemNumber: 3, title: '수박 5kg', quantityText: '5kg', keywords: ['수박', '수박 5키로', '5k'] },
];

const commentText = '2번 3개요';
const suggestions = analyzeComment(commentText, products, { maxSuggestions: 3 });

// suggestions 예:
// [
//   { itemNumber: 2, productName: '토마토 1박스', quantity: 3, confidence: 0.95, reason: '번호 기반' },
//   ...
// ]
```

## 여러 댓글 한번에 + 상품별 예상 수량 집계

```ts
import { analyzeComments } from '../func/client-matcher';

const comments = [
  { id: 'c1', text: '2번 3개' },
  { id: 'c2', text: '브로콜리 하나' },
  { id: 'c3', text: '수박 5키로' },
];

const { byComment, countsByProduct } = analyzeComments(comments, products);

// byComment['c1'] → 해당 댓글의 추천 Top-N
// countsByProduct[2] → { predictedQuantity: 3, comments: ['c1'] }
```

## UI 통합 팁

- 댓글 카드에 Top‑N 추천을 뱃지/드롭다운으로 표시하고, 클릭으로 선택/수정 가능하게 만듭니다.
- “예상 수량”은 프리뷰용입니다. 최종 집계는 서버 확정(수령완료) 시점에 저장/계산하세요.
- 고객검색 트리거 시, 해당 고객의 최근 댓글만 분석해 즉시 미리보기를 띄우면 현장 경험이 좋아집니다.

## 매칭 규칙(간단 요약)

- 번호 기반: `N번`, `N번 M개` → 해당 상품 우선, 신뢰도 높음.
- 단위 패턴: `N개/박스/봉지/팩/통/세트/키로` → 단위가 상품명과 맞는 상품 가중치+유사도.
- 상품명 유사도: 댓글과 상품명 토큰 유사도(Jaccard)로 Top‑N.
- 단일상품 수량: 댓글이 단순 수량이면 단일상품으로 해석.

## 주의사항

- 본 모듈은 “추천/프리뷰”용입니다. 자동 확정 용도가 아닙니다.
- 복잡한 옵션/다중 패턴은 서버 매처가 더 안정적입니다. 프런트는 신뢰도 낮은 결과를 표시/수정 유도에 활용하세요.
- 다중 상품 한 댓글 처리

```ts
import { analyzeCommentMulti } from '../func/client-matcher';

const products = [
  { itemNumber: 1, title: '배추김치 2kg', quantityText: '2kg' },
  { itemNumber: 2, title: '석박지 1kg', quantityText: '1kg', keywords: ['깍두기'] },
  { itemNumber: 3, title: '총각김치 1kg', quantityText: '1kg' },
  { itemNumber: 4, title: '쪽파김치 1kg', quantityText: '1kg', keywords: ['파김치'] },
  { itemNumber: 5, title: '열무김치 1kg', quantityText: '1kg' },
  { itemNumber: 6, title: '오이소박이김치 1kg', quantityText: '1kg', keywords: ['오이소박이', '오이'] },
];

const comment = '배정설/7729/상무점/쪽파김치1, 열무김치1, 오이소박이1';
const multi = analyzeCommentMulti(comment, products);
// multi 예:
// [
//  { itemNumber: 4, productName: '쪽파김치 1kg', quantity: 1, confidence: 0.9, reason: '단위 패턴' },
//  { itemNumber: 5, productName: '열무김치 1kg', quantity: 1, confidence: 0.9, reason: '단위 패턴' },
//  { itemNumber: 6, productName: '오이소박이김치 1kg', quantity: 1, confidence: 0.9, reason: '단위 패턴' },
// ]

const comment2 = '김미경 4481 상무점 배추김치, 석박지, 총각김치, 얼갈이겉절이김치';
const multi2 = analyzeCommentMulti(comment2, products);
// 수량이 없으면 1로 가정하여 각각 추천
```
