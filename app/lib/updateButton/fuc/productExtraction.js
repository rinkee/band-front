// AI ìƒí’ˆ ì¶”ì¶œ í•¨ìˆ˜
/**
 * í•¨ìˆ˜ëª…: extractProductInfoAI
 * ëª©ì : AIë¥¼ ì‚¬ìš©í•˜ì—¬ ê²Œì‹œë¬¼ ë‚´ìš©ì—ì„œ ìƒí’ˆ ì •ë³´ ì¶”ì¶œ (Gemini API ì‚¬ìš©)
 * ì‚¬ìš©ì²˜: processProduct
 * ì˜ì¡´ì„±: Gemini API, extractPickupDate
 * íŒŒë¼ë¯¸í„°:
 *   - content: ê²Œì‹œë¬¼ ë‚´ìš©
 *   - postTime: ê²Œì‹œë¬¼ ì‘ì„± ì‹œê°„
 *   - postKey: ê²Œì‹œë¬¼ í‚¤
 * ë¦¬í„´ê°’: ì¶”ì¶œëœ ìƒí’ˆ ì •ë³´ ë°°ì—´
 */
export async function extractProductInfoAI(content, postTime = null, postKey) {
  const aiApiKey = process.env.GOOGLE_API_KEY;
  const AI_MODEL = process.env.AI_MODEL || "gemini-2.5-flash-lite";
  const aiEndpoint = `https://generativelanguage.googleapis.com/v1beta/models/${AI_MODEL}:generateContent?key=${aiApiKey}`;

  // ê¸°ë³¸ ìƒí’ˆ ìƒì„± í•¨ìˆ˜ - ë¹ˆ ë°°ì—´ ë°˜í™˜ìœ¼ë¡œ ì˜ëª»ëœ ë°ì´í„° ìƒì„± ë°©ì§€
  function getDefaultProduct(errorMessage = "") {
    console.warn(`[AI ë¶„ì„] getDefaultProduct í˜¸ì¶œë¨ - ì´ìœ : ${errorMessage}`);
    console.trace("[AI ë¶„ì„] í˜¸ì¶œ ìŠ¤íƒ:"); // ì–´ë””ì„œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ì¶”ì 
    console.warn(`[AI ë¶„ì„] ì˜ëª»ëœ "ì£¼ë¬¸ ì–‘ì‹ í™•ì¸ í•„ìš”" ë°ì´í„° ìƒì„±ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë¹ˆ ë°°ì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤.`);
    // "ì£¼ë¬¸ ì–‘ì‹ í™•ì¸ í•„ìš”" ê°™ì€ ì˜ëª»ëœ ìƒí’ˆì´ DBì— ì €ì¥ë˜ëŠ” ê²ƒì„ ë°©ì§€
    // ë¹ˆ ë°°ì—´ì„ ë°˜í™˜í•˜ì—¬ í•´ë‹¹ ê²Œì‹œë¬¼ì— ëŒ€í•œ ìƒí’ˆì´ ìƒì„±ë˜ì§€ ì•Šë„ë¡ í•¨
    return [];
  }

  if (!aiApiKey || !aiEndpoint || !aiEndpoint.includes("?key=")) {
    console.warn("[AI ë¶„ì„] API í‚¤ ë˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ê°€ ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê¸°ë³¸ ìƒí’ˆì„ ë°˜í™˜í•©ë‹ˆë‹¤.");
    return getDefaultProduct("AI API ì„¤ì • ì˜¤ë¥˜");
  }

  if (!content || typeof content !== "string" || content.trim().length === 0) {
    console.warn("[AI ë¶„ì„] ìœ íš¨í•˜ì§€ ì•Šì€ ì½˜í…ì¸ ì…ë‹ˆë‹¤. ê¸°ë³¸ ìƒí’ˆì„ ë°˜í™˜í•©ë‹ˆë‹¤.");
    return getDefaultProduct("ì½˜í…ì¸  ì—†ìŒ");
  }

  // ì¬ì‹œë„ ì„¤ì •
  const MAX_RETRIES = 2; // ìµœëŒ€ 2ë²ˆ ì‹œë„ (ì´ˆê¸° ì‹œë„ + 1ë²ˆ ì¬ì‹œë„)
  const RETRY_DELAY = 1000; // 1ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„

  // ì¬ì‹œë„ ë£¨í”„ ì‹œì‘
  for (let attempt = 1; attempt <= MAX_RETRIES; attempt++) {
    try {
      console.log(`[AI ë¶„ì„] ì‹œì‘ - ì‹œë„ ${attempt}/${MAX_RETRIES}, postKey: ${postKey || "unknown"}`);

      // postTime ê²€ì¦ ë° ìš”ì¼ ì •ë³´ í¬í•¨ ë³€ìˆ˜ ìƒì„±
      let postTimeWithWeekday = postTime; // ê¸°ë³¸ê°’
      if (postTime) {
        console.log(`[AI ë¶„ì„] ë°›ì€ postTime ì›ë³¸ê°’:`, postTime);

        // postTime íƒ€ì…ë³„ ì²˜ë¦¬ë¡œ ìœ íš¨ì„± ê²€ì¦
        let postDate;
        if (typeof postTime === 'string') {
          postDate = new Date(postTime);
        } else if (typeof postTime === 'number') {
          postDate = new Date(postTime);
        } else if (postTime instanceof Date) {
          postDate = postTime;
        } else {
          console.warn(`[AI ë¶„ì„] ì•Œ ìˆ˜ ì—†ëŠ” postTime í˜•ì‹:`, postTime);
          postDate = new Date();
        }

        console.log(`[AI ë¶„ì„] Date ìœ íš¨ì„±:`, !isNaN(postDate.getTime()));

        if (isNaN(postDate.getTime())) {
          console.warn(`[AI ë¶„ì„] Date íŒŒì‹± ì‹¤íŒ¨, í˜„ì¬ ì‹œê°„ ì‚¬ìš©`);
          postDate = new Date();
        }

        // ìš”ì¼ ì •ë³´ í¬í•¨í•œ ìƒˆë¡œìš´ ë³€ìˆ˜ ìƒì„±
        const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
        const dayOfWeek = dayNames[postDate.getUTCDay()];
        postTimeWithWeekday = `${postDate.toISOString()} (${dayOfWeek})`;
      }

      const systemInstructions = `# ìƒí’ˆ ì •ë³´ ì¶”ì¶œ AI í”„ë¡¬í”„íŠ¸

## 1. ì‹œìŠ¤í…œ ì—­í• 
í…ìŠ¤íŠ¸ì—ì„œ ìƒí’ˆ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ ì§€ì •ëœ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•©ë‹ˆë‹¤. ë‹¤ë¥¸ í…ìŠ¤íŠ¸ëŠ” í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ê°€ê²©ì´ ëª…ì‹œëœ í…ìŠ¤íŠ¸ëŠ” ìƒí’ˆìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.

## 2. ìµœìš°ì„  ê·œì¹™ (ë‹¤ë¥¸ ëª¨ë“  ê·œì¹™ë³´ë‹¤ ìš°ì„ )

### 2.1 ë²ˆí˜¸ êµ¬ë¶„ ì ˆëŒ€ ìš°ì„  ê·œì¹™
**ë²ˆí˜¸ë¡œ êµ¬ë¶„ëœ ìƒí’ˆì€ ê°€ê²©ì´ë‚˜ ë‹¨ìœ„ê°€ ê°™ì•„ë„ ëª¨ë‘ ë³„ê°œ ìƒí’ˆìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.**
- 1ï¸âƒ£í”Œë ˆì¸ë§› 5,900ì›, 2ï¸âƒ£ë”¸ê¸°ë§› 5,900ì› â†’ 2ê°œ ìƒí’ˆ (ê°€ê²© ê°™ì•„ë„)
- â‘ ì‚¬ê³¼ 1ë°•ìŠ¤, â‘¡ë°° 1ë°•ìŠ¤ â†’ 2ê°œ ìƒí’ˆ (ë‹¨ìœ„ ê°™ì•„ë„)
- 1. ìƒí’ˆA, 2. ìƒí’ˆB, 3. ìƒí’ˆC â†’ 3ê°œ ìƒí’ˆ
- ë²ˆí˜¸ê°€ ìˆìœ¼ë©´ ì¤‘ë³µ íŒë‹¨ ê·œì¹™ì„ ì ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### 2.2 ë°˜ë°•ìŠ¤ëŠ” ë…ë¦½ ìƒí’ˆ ê·œì¹™
**"1ë°•ìŠ¤"ì™€ "ë°˜ë°•ìŠ¤"ëŠ” í•­ìƒ ì„œë¡œ ë‹¤ë¥¸ ë³„ê°œì˜ ìƒí’ˆì…ë‹ˆë‹¤.**
- "1ë°•ìŠ¤ 22,000ì›, ë°˜ë°•ìŠ¤ 11,500ì›" â†’ 2ê°œ ìƒí’ˆ
- "í•œë°•ìŠ¤"ì™€ "ë°˜ë°•ìŠ¤" â†’ 2ê°œ ìƒí’ˆ
- ë°˜ë°•ìŠ¤ëŠ” ë°•ìŠ¤ì˜ ì ˆë°˜ ìˆ˜ëŸ‰ì„ ì˜ë¯¸í•˜ëŠ” ë…ë¦½ì ì¸ íŒë§¤ ë‹¨ìœ„

### 2.3 ì†ŒìŠ¤ë³„ë„/ì†ŒìŠ¤ ì¶”ê°€ëŠ” ë…ë¦½ ìƒí’ˆ ê·œì¹™ (ì¤‘ìš”)
**ë³¸ë¬¸ì— "ì†ŒìŠ¤ë³„ë„", "ì†ŒìŠ¤ ë³„ë„", "ì†ŒìŠ¤ ì¶”ê°€", "ì†ŒìŠ¤ ë³„ë§¤" ë“±ì˜ ë¬¸êµ¬ì™€ í•¨ê»˜ ê°€ê²©ì´ ìˆìœ¼ë©´, ì†ŒìŠ¤ëŠ” ë°˜ë“œì‹œ ë³„ë„ì˜ ìƒí’ˆìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.**
- ì†ŒìŠ¤ëŠ” ë©”ì¸ ìƒí’ˆê³¼ ë‹¤ë¥¸ SKUë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.
- ì†ŒìŠ¤ ê°€ê²©ì´ ëª…ì‹œë˜ì–´ ìˆìœ¼ë©´ ê·¸ ê°€ê²©ìœ¼ë¡œ ìƒí’ˆì„ ìƒì„±í•©ë‹ˆë‹¤. (ì˜ˆ: "ì†ŒìŠ¤ë³„ë„(700ì› íŒë§¤í•©ë‹ˆë‹¤)" â†’ ì†ŒìŠ¤ 700ì›)
- ê´„í˜¸ ì•ˆ ê°€ê²©ì´ì–´ë„ ìœ íš¨í•©ë‹ˆë‹¤. ì´ ê·œì¹™ì€ ì•„ë˜ "ê´„í˜¸ ì•ˆ ê°€ê²© ì œì™¸" ê·œì¹™ì˜ ì˜ˆì™¸ì…ë‹ˆë‹¤.
- ë©”ì¸ ìƒí’ˆ(ì˜ˆ: í•¨ë°•ìŠ¤í…Œì´í¬)ê³¼ ì†ŒìŠ¤ê°€ í•¨ê»˜ ì¡´ì¬í•˜ë©´ 'multipleProducts'ëŠ” ë°˜ë“œì‹œ true ì…ë‹ˆë‹¤.
- ì´ ê²½ìš° ê²°ê³¼ì˜ 'variantType'ì€ "MIXED_PRODUCTS"ë¡œ ì„¤ì •í•˜ê³ , ê° ìƒí’ˆì˜ variantTypeë„ "MIXED_PRODUCTS"ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
- ì†ŒìŠ¤ì˜ titleì€ "ì†ŒìŠ¤"ë¡œ ë‹¨ìˆœí™”í•˜ë˜, íŠ¹ì • ì†ŒìŠ¤ëª…ì´ ëª…ì‹œëœ ê²½ìš°(ì˜ˆ: ë°ë¯¸ê¸€ë¼ìŠ¤ ì†ŒìŠ¤) í•´ë‹¹ ëª…ì¹­ì„ titleì— ì‚¬ìš©í•©ë‹ˆë‹¤.
- ë©”ì¸ ìƒí’ˆì˜ í• ì¸ ì „ ê°€ê²©(ì˜ˆ: 5,500ì›)ì€ ë¬´ì‹œí•˜ê³ , í• ì¸ëœ íŒë§¤ê°€(ì˜ˆ: 3,900ì›)ë§Œ ê°€ê²©ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì†ŒìŠ¤ ê°€ê²©ì€ ì†ŒìŠ¤ ë¼ì¸ì— í‘œì‹œëœ ê°€ê²©ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

ì˜ˆì‹œ)
ì…ë ¥ ìš”ì•½: "ê³ ê´€í•¨ë°•ìŠ¤í…Œì´í¬(1íŒ©177g) 5,500ì› â†’ 3,900ì›", "ì†ŒìŠ¤ë³„ë„(700ì› íŒë§¤í•©ë‹ˆë‹¤)"
â†’ ì¶œë ¥: multipleProducts=true, variantType="MIXED_PRODUCTS"
  - ìƒí’ˆ1: title="ê³ ê´€í•¨ë°•ìŠ¤í…Œì´í¬ 1íŒ© 177g", price=3900
  - ìƒí’ˆ2: title="ì†ŒìŠ¤", price=700

## 3. í•µì‹¬ ì›ì¹™

### 2.1 í• ì¸ ê°€ê²© ì²˜ë¦¬
í• ì¸ í‘œì‹œëŠ” í•˜ë‚˜ì˜ ìƒí’ˆì…ë‹ˆë‹¤. 2ê°œë¡œ ë‚˜ëˆ„ì§€ ì•ŠìŠµë‹ˆë‹¤.
- "7,000ì› â†’ 4,900ì›" = 1ê°œ ìƒí’ˆ (4,900ì›)
- "ğŸ‘‰ğŸ‘‰ğŸ‘‰7,000ì› ğŸ‘‰ğŸ‘‰ğŸ‘‰4,900ì›" = 1ê°œ ìƒí’ˆ (4,900ì›)
- "6.000ì›ğŸ‘‰ğŸ‘‰4,500ì›" = 1ê°œ ìƒí’ˆ (4,500ì›)
- "1í†µ-->> 6.000ì›ğŸ‘‰ğŸ‘‰4,500ì›" = 1ê°œ ìƒí’ˆ (4,500ì›)
- "ì‚¬ì „ì˜ˆì•½ê°€ : 14,800ì›(18,000ì›)" = 1ê°œ ìƒí’ˆ (14,800ì›)
- "ì˜ˆì•½ê°€ : 5,980ì›(8,500ì›)" = 1ê°œ ìƒí’ˆ (5,980ì›)
- ê°™ì€ ìƒí’ˆëª…/ë‹¨ìœ„ì— ì—¬ëŸ¬ ê°€ê²© = ê°€ì¥ ë‚®ì€ ê°€ê²©ë§Œ
- ì—°ì†ëœ ê°€ê²© í‘œì‹œëŠ” í• ì¸ìœ¼ë¡œ ê°„ì£¼ (ê³µë°±/ì´ëª¨í‹°ì½˜ ë¬´ê´€)

#### ë™ì¼ ìš©ëŸ‰/ìˆ˜ëŸ‰ì˜ ë‹¤ë¥¸ ê°€ê²© í‘œì‹œ = í• ì¸ ê´€ê³„
**ë‹¨ìœ„+ê´„í˜¸ì™€ ë‹¨ìˆœ í‘œì‹œê°€ ê°™ì€ ìš©ëŸ‰ì´ë©´ í• ì¸ ê´€ê³„ë¡œ ì²˜ë¦¬**
- "1ë´‰ì§€(150g) 10,000ì›" + "150g 8,500ì›" = 1ê°œ ìƒí’ˆ (8,500ì›)
- "1ë°•ìŠ¤(10ê°œ) 15,000ì›" + "10ê°œ 12,000ì›" = 1ê°œ ìƒí’ˆ (12,000ì›)
- ê´„í˜¸ ì•ˆ ìš©ëŸ‰ê³¼ ë…ë¦½ ìš©ëŸ‰ì´ ê°™ìœ¼ë©´ = ê°™ì€ ìƒí’ˆì˜ í• ì¸

### 3.2 ì¤‘ë³µ ë°©ì§€ ê·œì¹™ (ë²ˆí˜¸ êµ¬ë¶„ì´ ì—†ëŠ” ê²½ìš°ì—ë§Œ ì ìš©)
ë™ì¼í•œ ìƒí’ˆì„ ì¤‘ë³µìœ¼ë¡œ ì¶”ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

#### ì¤‘ë³µ íŒë‹¨ ê¸°ì¤€ (ë²ˆí˜¸ êµ¬ë¶„ì´ ì—†ì„ ë•Œë§Œ)
- ê°™ì€ ìƒí’ˆëª… + ê°™ì€ ê°€ê²© = ì¤‘ë³µ (í•œ ë²ˆë§Œ ì¶”ì¶œ)
- ê°™ì€ ìƒí’ˆëª… + ê°™ì€ ë‹¨ìœ„ = ì¤‘ë³µ (í•œ ë²ˆë§Œ ì¶”ì¶œ)
- âš ï¸ ì¤‘ìš”: ë²ˆí˜¸ë¡œ êµ¬ë¶„ëœ ìƒí’ˆì€ ì´ ê·œì¹™ì„ ì ìš©í•˜ì§€ ì•ŠìŒ
- ë‹¨ìœ„ í‘œí˜„ì´ ë‹¤ë¥´ë”ë¼ë„ ì˜ë¯¸ê°€ ê°™ìœ¼ë©´ ì¤‘ë³µ
  - "1í‚¤ë¡œ" = "1kg" = "1KG" = "1kgí•œì„¸íŠ¸" = "1kg 1ë‹¨"
  - "1ë°•ìŠ¤" = "í•œë°•ìŠ¤" = "1box"

#### âš ï¸ ë°˜ë°•ìŠ¤ëŠ” ë³„ê°œ ìƒí’ˆ (ì¬ê°•ì¡°)
**"1ë°•ìŠ¤"ì™€ "ë°˜ë°•ìŠ¤"ëŠ” ë¬´ì¡°ê±´ ì„œë¡œ ë‹¤ë¥¸ ìƒí’ˆìœ¼ë¡œ ì²˜ë¦¬**
- "1ë°•ìŠ¤" â‰  "ë°˜ë°•ìŠ¤" (ë³„ê°œ ìƒí’ˆ) - ë°˜ë“œì‹œ 2ê°œ ì¶”ì¶œ
- "í•œë°•ìŠ¤" â‰  "ë°˜ë°•ìŠ¤" (ë³„ê°œ ìƒí’ˆ) - ë°˜ë“œì‹œ 2ê°œ ì¶”ì¶œ
- ë°˜ë°•ìŠ¤ëŠ” ì •í™•íˆ ë°•ìŠ¤ì˜ ì ˆë°˜ ìˆ˜ëŸ‰ì„ ì˜ë¯¸í•˜ëŠ” ë³„ë„ íŒë§¤ ë‹¨ìœ„
- ì˜ˆì‹œ: "ìº ë²¨í¬ë„ 1ë°•ìŠ¤ 22,000ì›, ë°˜ë°•ìŠ¤ 11,500ì›" â†’ 2ê°œ ìƒí’ˆ ì¶”ì¶œ í•„ìˆ˜

#### ê°™ì€ ìƒí’ˆ íŒë‹¨ ì¶”ê°€ ê¸°ì¤€ (í• ì¸ ê´€ê³„ ì²˜ë¦¬)
ë‹¨ìœ„+ê´„í˜¸ìš©ëŸ‰ê³¼ ë‹¨ìˆœìš©ëŸ‰ì´ ê°™ìœ¼ë©´ ë™ì¼ ìƒí’ˆìœ¼ë¡œ ì²˜ë¦¬
- "1ë´‰ì§€(150g)"ì™€ "150g" = ê°™ì€ ìƒí’ˆ (ìš©ëŸ‰ì´ ë™ì¼, í• ì¸ ê´€ê³„)
- "1ë°•ìŠ¤(10ê°œ)"ì™€ "10ê°œ" = ê°™ì€ ìƒí’ˆ (ìˆ˜ëŸ‰ì´ ë™ì¼, í• ì¸ ê´€ê³„)
- "2ìƒì(500ml*12)"ì™€ "500ml*12" = ê°™ì€ ìƒí’ˆ (ë‚´ìš©ë¬¼ì´ ë™ì¼)
- ì´ëŸ° ê²½ìš° ë” ë‚®ì€ ê°€ê²©ìœ¼ë¡œ í•˜ë‚˜ì˜ ìƒí’ˆë§Œ ì¶”ì¶œ

#### ì„¸íŠ¸ ìƒí’ˆê³¼ ë‹¨ê°€ í‘œì‹œ ì¤‘ë³µ ë°©ì§€
ê°œë³„ ë‹¨ê°€ Ã— ì„¸íŠ¸ ìˆ˜ëŸ‰ = ì„¸íŠ¸ ê°€ê²©ì¸ ê²½ìš°
- "1ê°œ 625ì›" + "4ê°œì… 1ì„¸íŠ¸ 2,500ì›" (625Ã—4=2,500) â†’ ì„¸íŠ¸ë§Œ ì¶”ì¶œ
- "ë‚±ê°œ 1,000ì›" + "10ê°œ ë¬¶ìŒ 10,000ì›" (1,000Ã—10=10,000) â†’ ë¬¶ìŒë§Œ ì¶”ì¶œ
- ê³„ì‚°ì´ ì •í™•íˆ ë§ìœ¼ë©´ ì„¸íŠ¸/ë¬¶ìŒ ìƒí’ˆë§Œ ì˜ë¯¸ìˆëŠ” íŒë§¤ ë‹¨ìœ„
- ê°œë³„ ë‹¨ê°€ëŠ” ì°¸ê³ ìš©ì´ë¯€ë¡œ ìƒí’ˆìœ¼ë¡œ ì¶”ì¶œí•˜ì§€ ì•ŠìŒ

#### ì¤‘ë³µ ì²´í¬ í”„ë¡œì„¸ìŠ¤
1. ëª¨ë“  ìƒí’ˆ ì¶”ì¶œ
2. ìƒí’ˆëª… ì •ê·œí™” (ë‚ ì§œ, íŠ¹ìˆ˜ë¬¸ì ì œê±°)
3. ë‹¨ìœ„ ì •ê·œí™” í›„ ì¤‘ë³µ ì²´í¬
4. ê°™ì€ ìƒí’ˆì˜ í• ì¸ ê´€ê³„ í™•ì¸
5. ê³ ìœ í•œ ìƒí’ˆë§Œ ë°˜í™˜

### 3.3 ìƒí’ˆ ê°œìˆ˜ ê²°ì • ê·œì¹™

#### ìµœìš°ì„ : ë²ˆí˜¸ êµ¬ë¶„ì´ ìˆëŠ” ê²½ìš°
**ë²ˆí˜¸ê°€ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ ë²ˆí˜¸ ê°œìˆ˜ë§Œí¼ ìƒí’ˆ ì¶”ì¶œ**
- ê°€ê²©ì´ ê°™ì•„ë„ ë²ˆí˜¸ê°€ ë‹¤ë¥´ë©´ ë‹¤ë¥¸ ìƒí’ˆ
- ë‹¨ìœ„ê°€ ê°™ì•„ë„ ë²ˆí˜¸ê°€ ë‹¤ë¥´ë©´ ë‹¤ë¥¸ ìƒí’ˆ
- ì˜ˆ: 1ï¸âƒ£í”Œë ˆì¸ 5,900ì›, 2ï¸âƒ£ë”¸ê¸° 5,900ì› â†’ 2ê°œ ìƒí’ˆ

#### ì°¨ì„ : ë²ˆí˜¸ êµ¬ë¶„ì´ ì—†ëŠ” ê²½ìš°
- ê³ ìœ  ê°€ê²© ê°œìˆ˜ = ìƒí’ˆ ê°œìˆ˜
- ë‹¤ë¥¸ ê°€ê²© = ë‹¤ë¥¸ ìƒí’ˆ
- ìµœì¢… ê°€ê²© ê¸°ì¤€ìœ¼ë¡œë§Œ íŒë‹¨ (í• ì¸ ì „ ê°€ê²© ë¬´ì‹œ)

ì¸ì‹í•˜ëŠ” ë²ˆí˜¸ íŒ¨í„´:
- ì´ëª¨ì§€ ë²ˆí˜¸: 1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£
- í…ìŠ¤íŠ¸ ë²ˆí˜¸: "1ë²ˆ", "2ë²ˆ", "3ë²ˆ"
- ìˆ«ì ë¦¬ìŠ¤íŠ¸: "1.", "2.", "3."
- ê¸°í˜¸ ë²ˆí˜¸: "â‘ ", "â‘¡", "â‘¢"

### 2.4 ê°€ê²© ì¶”ì¶œ ê·œì¹™

#### ì¶”ì¶œ ëŒ€ìƒ (íŒë§¤ ê°€ê²©) - ìš°ì„ ìˆœìœ„ ìˆœ
1. "ì‚¬ì „ì˜ˆì•½ê°€", "ì˜ˆì•½ê°€" ë‹¤ìŒì— ì˜¤ëŠ” ì²« ë²ˆì§¸ ê°€ê²© (ìµœìš°ì„ )
2. âœ”, âœ“, â†’, ğŸ‘‰, -->>, ->, â‡’ ê¸°í˜¸ì™€ í•¨ê»˜ í‘œì‹œëœ ê°€ê²©
3. "íŒë§¤", "ê³µêµ¬ê°€", "íŠ¹ê°€"ì™€ ì—°ê²°ëœ ê°€ê²©
4. ìˆ«ì+ì› í˜•íƒœì˜ ëª…í™•í•œ ê°€ê²© (ì‰¼í‘œ, ì  êµ¬ë¶„ ëª¨ë‘ ì¸ì‹)
   - "4,500ì›", "6.000ì›", "10000ì›" ëª¨ë‘ ìœ íš¨í•œ ê°€ê²© í˜•íƒœ

#### ì œì™¸ ëŒ€ìƒ (ì›ê°€/ë¹„êµ ê°€ê²©)
- ê´„í˜¸ ì•ˆì˜ ê°€ê²© (ì˜ˆ: (18,000ì›), (8,500ì›))
- "ê¸°ì¡´"ì´ í¬í•¨ëœ ëª¨ë“  ë¼ì¸
- ì›ë˜, ì˜ˆì „, ì´ì „, ì‹œì¤‘ê°€, ì •ê°€, ì›ê°€
- í¸ì˜ì , ë§ˆíŠ¸, íƒ€ì‚¬

### 2.5 ìƒí’ˆ vs ê³µì§€ì‚¬í•­ êµ¬ë¶„
- **ìƒí’ˆìœ¼ë¡œ íŒë‹¨**: ê°€ê²©ì´ ëª…ì‹œë˜ì–´ ìˆìŒ
- **ê³µì§€ì‚¬í•­ìœ¼ë¡œ íŒë‹¨**: ê°€ê²© ì •ë³´ê°€ ì „í˜€ ì—†ìŒ

### 2.6 ì„¸íŠ¸ ìƒí’ˆì˜ ë‹¨ê°€ í‘œì‹œ ì²˜ë¦¬
**ì„¸íŠ¸/ë¬¶ìŒ ìƒí’ˆê³¼ ê°œë³„ ë‹¨ê°€ê°€ í•¨ê»˜ ë‚˜ì˜¬ ë•Œ ì²˜ë¦¬ ê·œì¹™**

#### ë‹¨ê°€ ê³„ì‚°ì‹ì´ ë§ëŠ” ê²½ìš° = ì„¸íŠ¸ ìƒí’ˆë§Œ ì¶”ì¶œ
**ê°œë³„ ê°€ê²©ì´ ë‹¨ìˆœ ì°¸ê³ ìš©ì¼ ë•Œ ì„¸íŠ¸ë§Œ ìƒí’ˆìœ¼ë¡œ ì¸ì‹**
- "1ê°œ 625ì›" + "4ê°œì… 1ì„¸íŠ¸ 2,500ì›" (625Ã—4=2,500) â†’ ì„¸íŠ¸ë§Œ ì¶”ì¶œ
- "1ê°œ 1,000ì›" + "10ê°œì… 1ë°•ìŠ¤ 10,000ì›" (1,000Ã—10=10,000) â†’ ë°•ìŠ¤ë§Œ ì¶”ì¶œ
- "ë‚±ê°œ 500ì›" + "12ê°œì… 6,000ì›" (500Ã—12=6,000) â†’ ë¬¶ìŒë§Œ ì¶”ì¶œ

#### íŒë‹¨ ê¸°ì¤€
1. **ê³„ì‚° ì¼ì¹˜**: ê°œë³„ê°€ê²© Ã— ì„¸íŠ¸ìˆ˜ëŸ‰ = ì„¸íŠ¸ê°€ê²©ì´ë©´ â†’ ì„¸íŠ¸ë§Œ íŒë§¤ ìƒí’ˆ
2. **ë‹¨ê°€ í‚¤ì›Œë“œ**: "ë‚±ê°œ", "ê°œë³„", "1ê°œ" ê°€ê²©ì´ ì„¸íŠ¸ì™€ í•¨ê»˜ â†’ ë‹¨ê°€ í‘œì‹œ ê°€ëŠ¥ì„±
3. **ì„¸íŠ¸ ê°•ì¡°**: ì„¸íŠ¸/ë°•ìŠ¤/ë¬¶ìŒì´ ì´ëª¨ì§€ë‚˜ íŠ¹ë³„ í‘œê¸°ë¡œ ê°•ì¡° â†’ ì„¸íŠ¸ ìœ„ì£¼ íŒë§¤
4. **í• ì¸ ì—†ìŒ**: ë‹¨ê°€Ã—ìˆ˜ëŸ‰=ì„¸íŠ¸ê°€ê²©ì´ë©´ í• ì¸ì´ ì—†ìœ¼ë¯€ë¡œ ì„¸íŠ¸ë§Œ ì˜ë¯¸ ìˆìŒ


### ê¸°ë³¸ ìƒí’ˆëª… êµ¬ì„±
- ì •ì‹ ìƒí’ˆëª… ìš°ì„ 
- ì›ì‚°ì§€ëŠ” êµ¬ë¶„ í•„ìš”ì‹œì—ë§Œ í¬í•¨:
  - ìˆ˜ì…ì‚°ì€ í•­ìƒ í‘œê¸° (ë…¸ë¥´ì›¨ì´ì‚°, ì¹ ë ˆì‚° ë“±)
  - í”„ë¦¬ë¯¸ì—„ ì§€ì—­ì€ í‘œê¸° (ì œì£¼ì‚°, íš¡ì„± ë“±)
  - ì¼ë°˜ êµ­ë‚´ì‚°ì€ ìƒëµ (ê¸°ë³¸ê°’)
- ê´„í˜¸ ë‚´ìš© ì„ íƒì  ì²˜ë¦¬ - ì¤‘ìš” ì •ë³´ëŠ” ë³´ì¡´, ë¶ˆí•„ìš”í•œ ì •ë³´ë§Œ ì œê±°

  #### ë³´ì¡´í•´ì•¼ í•  ê´„í˜¸ ë‚´ìš© (ê´„í˜¸ ê¸°í˜¸ë§Œ ì œê±°, ë‚´ìš©ì€ ìœ ì§€)
  - ê³¼ì¼ í¬ê¸°/ë“±ê¸‰: (4ìˆ˜), (3ìˆ˜), (ëŒ€), (ì¤‘), (ì†Œ), (íŠ¹), (ìƒ)
  - í’ˆì§ˆ ë“±ê¸‰: (íŠ¹í’ˆ), (ìƒí’ˆ), (1ë“±ê¸‰), (í”„ë¦¬ë¯¸ì—„), (ê³ ê¸‰)
  - ìˆ˜ëŸ‰ ì •ë³´: (10ê°œ), (12ê°œì…), (24ì•Œ), (6ë§ˆë¦¬)
  - ìš©ëŸ‰ ì •ë³´: (500g), (1kg), (2L), (150ml)
  - í¬ì¥ ë‹¨ìœ„: (1ë°•ìŠ¤), (2ìƒì), (3íŒ©)
  - ë¶€ìœ„/ì¢…ë¥˜: (ë“±ì‹¬), (ì•ˆì‹¬), (ê°ˆë¹„), (ëª©ì‹¬), (ì œìœ¡ìš©), (êµ­ê±°ë¦¬ìš©)
  - ìƒíƒœ ì •ë³´: (ëƒ‰ë™), (ëƒ‰ì¥), (ìƒ), (í™œì–´), (ì†ì§ˆ)

  #### ì œê±°í•  ê´„í˜¸ ë‚´ìš©
  - ì¼ë°˜ ì›ì‚°ì§€: (êµ­ë‚´ì‚°) - ê¸°ë³¸ê°’ì´ë¯€ë¡œ ì œê±°
  - ì„¤ëª…ì„± ì •ë³´: (ì‹ ì„ í•œ), (ë§›ìˆëŠ”), (ê³ í’ˆì§ˆ)
  - ë²”ìœ„ í‘œì‹œ: (200g ë‚´ì™¸), (ì•½ 1kg)

  #### ì˜ˆì‹œ (ì˜¬ë°”ë¥¸ ì²˜ë¦¬)
  - "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“1ë°•ìŠ¤(4ìˆ˜)2KG" â†’ "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“ 1ë°•ìŠ¤ 4ìˆ˜ 2KG"
  - "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“1ë°•ìŠ¤(3ìˆ˜)2KG" â†’ "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“ 1ë°•ìŠ¤ 3ìˆ˜ 2KG"
  - "ì „ë³µ(êµ­ë‚´ì‚°)" â†’ "ì „ë³µ" (êµ­ë‚´ì‚°ì€ ê¸°ë³¸ê°’ì´ë¯€ë¡œ ì œê±°)
  - "ìë°˜ê³ ë“±ì–´(ë…¸ë¥´ì›¨ì´ì‚°)" â†’ "ìë°˜ê³ ë“±ì–´ ë…¸ë¥´ì›¨ì´ì‚°" (ìˆ˜ì…ì‚°ì€ ë³´ì¡´)
  - "ë¼ì§€ì•ë‹¤ë¦¬(ì œìœ¡ìš©)" â†’ "ë¼ì§€ì•ë‹¤ë¦¬ ì œìœ¡ìš©" (ë¶€ìœ„ ì •ë³´ ë³´ì¡´)
  - "ë¯¼ì–´íšŒ(êµ­ë‚´ì‚°)200g(í™œì–´)" â†’ "ë¯¼ì–´íšŒ 200g í™œì–´" (í™œì–´ ì •ë³´ ë³´ì¡´)
  - "ë¬´í•­ìƒì œ í•œìš°êµ­ê±°ë¦¬(ë©ì–´ë¦¬) 300g" â†’ "ë¬´í•­ìƒì œ í•œìš°êµ­ê±°ë¦¬ ë©ì–´ë¦¬ 300g"
  - "ì™„ìˆ™í† ë§ˆí† (ìœ ê¸°ë†)" â†’ "ì™„ìˆ™í† ë§ˆí†  ìœ ê¸°ë†" (í’ˆì§ˆ ì •ë³´ ë³´ì¡´)
  - "ê³ ê¸‰ ì•¼ì±„ ì²­ê²½ì±„ 1ë´‰ì§€(200g ë‚´ì™¸)" â†’ "ê³ ê¸‰ ì•¼ì±„ ì²­ê²½ì±„ 1ë´‰ì§€" (ë²”ìœ„ í‘œì‹œë§Œ ì œê±°)
- ë‚ ì§œ íŒ¨í„´ ì œê±° (í”½ì—… ë‚ ì§œ [Mì›”Dì¼]ì€ ìœ ì§€, ISO í˜•ì‹ë§Œ ì œê±°)
  - "[9ì›”5ì¼] 9ì›”4ì¼ íš¡ì„± í† ë§ˆí† " â†’ "[9ì›”5ì¼] íš¡ì„± í† ë§ˆí† " (ëŒ€ê´„í˜¸ ë‚ ì§œëŠ” ìœ ì§€)
  - "2024.09.05 ìœ ê¸°ë† ë°°ì¶”" â†’ "ìœ ê¸°ë† ë°°ì¶”" (ISO í˜•ì‹ ì œê±°)
  - "2025-09-02 í•œìš° ë“±ì‹¬" â†’ "í•œìš° ë“±ì‹¬" (ISO í˜•ì‹ ì œê±°)
  - "24-09-05 í•œìš°" â†’ "í•œìš°" (ì§§ì€ ISO í˜•ì‹ ì œê±°)
- ì¤‘ë³µ í‚¤ì›Œë“œ ì œê±°
  - "ìœ ê¸°ë† í† ë§ˆí†  ì™„ìˆ™í† ë§ˆí†  ìœ ê¸°ë†" â†’ "ìœ ê¸°ë† ì™„ìˆ™í† ë§ˆí† "
  - "êµ­ë‚´ì‚° í•œìš° êµ­ë‚´ì‚° ë“±ì‹¬" â†’ "êµ­ë‚´ì‚° í•œìš° ë“±ì‹¬"
  - ë” êµ¬ì²´ì ì¸ í‚¤ì›Œë“œ ìš°ì„  (ë™ì¼ ìƒí’ˆëª…ì˜ ê²½ìš°): "í† ë§ˆí†  ì™„ìˆ™í† ë§ˆí† " â†’ "ì™„ìˆ™í† ë§ˆí† "
- ë‹¨ìœ„ í‘œì‹œ ê·œì¹™ (ì„¸íŠ¸/ë¬¶ìŒì€ í•­ìƒ ë³´ì¡´):
  - ì„¸íŠ¸/ë¬¶ìŒ: í•­ìƒ ë³´ì¡´ (1ì„¸íŠ¸, 2ë¬¶ìŒ, 3íŒ¨í‚¤ì§€)
  - ë°•ìŠ¤/ìƒì: ìˆìœ¼ë©´ ë³´ì¡´ (1ë°•ìŠ¤, 2ìƒì)
  - ìˆ˜ëŸ‰: êµ¬ì²´ì  ê°œìˆ˜ ë³´ì¡´ (4ì•Œ, 10ê°œ, 5ë´‰)
  - ìš©ëŸ‰: í•„ìš”ì‹œ ë³´ì¡´ (300g, 500ml)
  - ì¡°í•© í—ˆìš©: "1ì„¸íŠ¸ 4ì•Œ", "2ë¬¶ìŒ 8ê°œ", "1ë°•ìŠ¤ 12ê°œ" ë“± ìì—°ìŠ¤ëŸ¬ìš´ ì¡°í•©
  - ìµœëŒ€ ì œí•œ: 3ê°œ ì´ìƒ ë‹¨ìœ„ëŠ” ì¤‘ìš”ë„ ìˆœìœ¼ë¡œ ì„ ë³„
- ì œì™¸: ë‚ ì§œ ì •ë³´, ì¬ê³  í‘œì‹œ, ì´ëª¨í‹°ì½˜, í”„ë¡œëª¨ì…˜ ë¬¸êµ¬

### ë‹¨ìœ„ í‘œê¸° ê·œì¹™

#### ë°•ìŠ¤/ìƒì ì •ê·œí™” (í•„ìˆ˜)
- "ë°˜ë°•ìŠ¤" â†’ "ë°˜ë°•ìŠ¤" (ìœ ì§€)
- "í•œë°•ìŠ¤" â†’ "1ë°•ìŠ¤" (ë³€ê²½)
- "ë°˜ìƒì" â†’ "ë°˜ìƒì" (ìœ ì§€)
- "í•œìƒì" â†’ "1ìƒì" (ë³€ê²½)

#### ë‚´ìš©ë¬¼ í‘œê¸°
- ë°•ìŠ¤: "1ë°•ìŠ¤ 12ê°œ"
- ë´‰ì§€: "1ë´‰ì§€ 10ê°œ"
- ì„¸íŠ¸: ê²Œì‹œë¬¼ì— ëª…ì‹œëœ ê²½ìš°ë§Œ ì‚¬ìš©

#### ì›ë¬¸ ë‹¨ìœ„ ë³´ì¡´
- "3ì•Œ", "5êµ¬", "2ì†¡ì´", "1ì†" â†’ ê·¸ëŒ€ë¡œ ìœ ì§€

### ìˆ˜ëŸ‰ë³„ ê°€ê²© ì°¨ì´ ìƒí’ˆ â€” ë°˜ë“œì‹œ ë³„ë„ ìƒí’ˆìœ¼ë¡œ ì¶”ì¶œ
ìˆ˜ëŸ‰ ê¸°ì¤€ìœ¼ë¡œ ê°€ê²©ì´ ë‹¬ë¼ì§€ëŠ” ê²½ìš°ëŠ” ê° êµ¬ê°„ì„ **ë¬´ì¡°ê±´ ë³„ë„ ìƒí’ˆ**ìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.

**ì¸ì‹í•´ì•¼ í•  íŒ¨í„´ (í•„ìˆ˜):**
- "1ê°œ Xì›", "2ê°œë¶€í„° Yì›", "2ê°œì´ìƒ Yì›"
- "1íŒ© Xì›", "2íŒ©ë¶€í„° Yì›ì”©", "2íŒ©ì´ìƒ Yì›"
- "1ë´‰ì§€ Xì›", "2ë´‰ì§€ì´ìƒ Yì›ì”©"
- "1ë°•ìŠ¤ Xì›", "2ë°•ìŠ¤ Yì›"
- "Nê°œ/íŒ©/ë´‰ì§€/ë°•ìŠ¤ + (ë¶€í„°/ì´ìƒ/~)" íŒ¨í„´ ëª¨ë‘

**ì œëª© ê·œì¹™ (í•„ìˆ˜):**
ê¸°ë³¸ ìƒí’ˆëª… ë’¤ì— êµ¬ê°„ ë¼ë²¨ì„ **ë°˜ë“œì‹œ** ë¶™ì…ë‹ˆë‹¤.
- "1ê°œ", "1íŒ©", "1ë´‰ì§€" â†’ ê·¸ëŒ€ë¡œ ë¶™ì„
- "2ê°œë¶€í„°", "2íŒ©ë¶€í„°", "2ê°œì´ìƒ" â†’ "2ê°œ ì´ìƒ", "2íŒ© ì´ìƒ"ìœ¼ë¡œ ì •ê·œí™”
- ì˜ˆì‹œ:
  - "ë¸”ë£¨ë² ë¦¬ 1íŒ© 4,500ì›" â†’ ìƒí’ˆ1: title="ë¸”ë£¨ë² ë¦¬ 1íŒ©", price=4500, quantityText="1íŒ©", variantType="STANDARD"
  - "2íŒ©ë¶€í„° 4,000ì›ì”©" â†’ ìƒí’ˆ2: title="ë¸”ë£¨ë² ë¦¬ 2íŒ© ì´ìƒ", price=4000, quantityText="2íŒ© ì´ìƒ", variantType="STANDARD"
  - "ë°©ì´Œì‹œì¥ë–¡ë³¶ì´ 500g\n1íŒ© 5,500ì›\n2íŒ©ë¶€í„° 5,000ì›" â†’ 2ê°œ ìƒí’ˆ:
    - ìƒí’ˆ1: title="ë°©ì´Œì‹œì¥ë–¡ë³¶ì´ 1íŒ©", price=5500, quantityText="1íŒ©"
    - ìƒí’ˆ2: title="ë°©ì´Œì‹œì¥ë–¡ë³¶ì´ 2íŒ© ì´ìƒ", price=5000, quantityText="2íŒ© ì´ìƒ"
  - "ì–´í¬ íŠ€ê° 1ë´‰ 3,000ì› / 4ë´‰ ë¬¶ìŒ 10,000ì›" â†’ 2ê°œ ìƒí’ˆ:
    - ìƒí’ˆ1: title="ì–´í¬ íŠ€ê° 1ë´‰", price=3000, quantityText="1ë´‰"
    - ìƒí’ˆ2: title="ì–´í¬ íŠ€ê° 4ë´‰ ë¬¶ìŒ", price=10000, quantityText="4ë´‰"

**ì¤‘ìš”:**
- êµ¬ê°„ ë¼ë²¨ì´ ë‹¤ë¥´ë©´ ë¬´ì¡°ê±´ ë‹¤ë¥¸ ìƒí’ˆì…ë‹ˆë‹¤ (ê°€ê²©ì´ ê°™ì•„ë„).
- "~ì”©"ì€ ë‹¨ê°€(ê°œë‹¹/ë´‰ì§€ë‹¹)ë¥¼ ì˜ë¯¸í•˜ë¯€ë¡œ ê·¸ëŒ€ë¡œ íŒë§¤ê°€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ê° ìƒí’ˆì˜ priceOptionsëŠ” ë¹ˆ ë°°ì—´([])ë¡œ ë‘ê³ , variantTypeì€ STANDARDë¡œ ìœ ì§€í•©ë‹ˆë‹¤.
- multipleProductsëŠ” êµ¬ê°„ì´ 2ê°œ ì´ìƒì´ë©´ trueë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

ìˆ˜ëŸ‰ë³„ ê°€ê²© ì°¨ì´ê°€ ì•„ë‹Œ ì™„ì „íˆ ë‹¤ë¥¸ ìƒí’ˆ(ì˜ˆ: ì „í˜€ ë‹¤ë¥¸ ë§›/êµ¬ì„±)ìœ¼ë¡œ íŒë‹¨ë  ë•ŒëŠ” 'multipleProducts: true' + ê° ìƒí’ˆì˜ variantTypeì„ "MIXED_PRODUCTS"ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

### variantType í•„ë“œ ì •ì˜
- "STANDARD": ì¶”ê°€ ê·œì¹™ì´ ì—†ëŠ” ì¼ë°˜ ìƒí’ˆ (ê¸°ë³¸ê°’). ìˆ˜ëŸ‰ë³„ ê°€ê²© ì°¨ì´ ìƒí’ˆë„ ê°ê° STANDARDë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
- "MIXED_PRODUCTS": ê²Œì‹œë¬¼ì— ì„œë¡œ ë‹¤ë¥¸ ìƒí’ˆì´ ì—¬ëŸ¬ ê°œ ì¡´ì¬í•˜ëŠ” ê²½ìš° (ì˜ˆ: í•¨ë°•ìŠ¤í…Œì´í¬ + ì†ŒìŠ¤). multipleProductsëŠ” true, ê° ìƒí’ˆ ê°ì²´ì˜ variantTypeë„ "MIXED_PRODUCTS"ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

ì°¸ê³ : ìˆ˜ëŸ‰ë³„ ê°€ê²© ì°¨ì´ ìƒí’ˆ(1íŒ©/2íŒ© ì´ìƒ)ì€ ë” ì´ìƒ QUANTITY_VARIANTë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ê°ê°ì„ ë³„ë„ì˜ STANDARD ìƒí’ˆìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.


#### ì ˆëŒ€ ì¶”ì¶œ ê¸ˆì§€:
- ê°€ê²© ì •ë³´: "ì‚¬ì „ì˜ˆì•½ê°€ 43,500ì›"
- í• ì¸ ì •ë³´: "(50,000ì›)"
- ìƒí’ˆ ì„¤ëª…: "ì…ì•ˆ ê°€ë“ ê³ ì†Œí•˜ê³  ë‹´ë°±í•œ"


## 6. JSON ì¶œë ¥ êµ¬ì¡°

{
  "multipleProducts": boolean,
  "variantType": "STANDARD" | "QUANTITY_VARIANT" | "MIXED_PRODUCTS",
  "products": [
    {
      "itemNumber": 1,
      "title": "ìƒí’ˆëª…",
      "basePrice": í• ì¸ëœ_íŒë§¤ê°€ê²©,
      "price": í• ì¸ëœ_íŒë§¤ê°€ê²©,
      "quantity": 1,
      "quantityText": "ë‹¨ìœ„",
      "description": "ìƒì„¸ì„¤ëª…",
      "priceOptions": [
        {
          "quantity": 1,
          "price": í• ì¸ëœ_íŒë§¤ê°€ê²©,
          "description": "ì˜µì…˜ ì„¤ëª…",
          "minQuantity"?: ìµœì†Œì£¼ë¬¸ìˆ˜ëŸ‰,
          "unitLabel"?: "íŒ©" | "ë°•ìŠ¤" | ...
        }
      ],
      "category": "ì‹í’ˆ",
      "status": "íŒë§¤ì¤‘",
       "postTime": null,
      "pickupInfo": "9.5~6(2ì¼ê°„) ë˜ëŠ” ë§¤ì£¼ ê¸ˆìš”ì¼ í˜•íƒœì˜ ì‹¤ì œ ìˆ˜ë ¹ ì¼ì • ì •ë³´",
      "pickupDate": null,
      "pickupType": "ìˆ˜ë ¹",
      "stockQuantity": null,
      "order_needs_ai": false,
      "order_needs_ai_reason": null,
      "variantType": "STANDARD" | "QUANTITY_VARIANT" | "MIXED_PRODUCTS"
      // title ë‚ ì§œëŠ” pickupDateì™€ ì¼ì¹˜í•´ì•¼ í•¨
    }
  ]
}

## 6.5 basePriceì™€ price í•„ë“œ ê·œì¹™
basePriceì™€ priceëŠ” ëª¨ë‘ ë™ì¼í•œ í• ì¸ëœ íŒë§¤ê°€ê²©ì´ì–´ì•¼ í•¨

- basePrice: ê³ ê°ì´ ì‹¤ì œë¡œ ì§€ë¶ˆí•  í• ì¸ëœ íŒë§¤ê°€ê²© (DB ì €ì¥ìš©)
- price: ê³ ê°ì´ ì‹¤ì œë¡œ ì§€ë¶ˆí•  í• ì¸ëœ íŒë§¤ê°€ê²© (ë™ì¼í•œ ê°’)
- ì˜ëª»ëœ ì˜ˆ: basePriceì— ì›ê°€, priceì— í• ì¸ê°€ë¥¼ ê°ê° ë‹¤ë¥´ê²Œ ì„¤ì •
- ì˜¬ë°”ë¥¸ ì˜ˆ: "basePrice": 12800, "price": 12800 (ë‘˜ ë‹¤ í• ì¸ê°€)
- ì˜ëª»ëœ ì˜ˆ: "basePrice": 16000, "price": 12800 (ì›ê°€ì™€ í• ì¸ê°€ ë¶„ë¦¬)


## 8. ìµœì¢… ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸
1. **ë²ˆí˜¸ë¡œ êµ¬ë¶„ëœ ìƒí’ˆì„ ëª¨ë‘ ì¶”ì¶œí–ˆëŠ”ê°€?** (ê°€ê²©/ë‹¨ìœ„ê°€ ê°™ì•„ë„)
2. **ë°˜ë°•ìŠ¤ë¥¼ ë…ë¦½ ìƒí’ˆìœ¼ë¡œ ì¶”ì¶œí–ˆëŠ”ê°€?** (1ë°•ìŠ¤ì™€ ë°˜ë°•ìŠ¤ëŠ” 2ê°œ ìƒí’ˆ)
3. ì¤‘ë³µëœ ìƒí’ˆì´ ì—†ëŠ”ê°€? (ë²ˆí˜¸ êµ¬ë¶„ì´ ì—†ëŠ” ê²½ìš°ë§Œ)
4. í• ì¸ ê°€ê²©ì„ 2ê°œ ìƒí’ˆìœ¼ë¡œ ë‚˜ëˆ„ì§€ ì•Šì•˜ëŠ”ê°€?
5. "í•œë°•ìŠ¤", "í•œìƒì"ë¥¼ "1ë°•ìŠ¤", "1ìƒì"ë¡œ ë³€ê²½í–ˆëŠ”ê°€?
6. basePriceì™€ priceê°€ ëª¨ë‘ ë™ì¼í•œ í• ì¸ëœ íŒë§¤ê°€ê²©ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ê°€?
7. pickupInfoì— ê°€ê²© ì •ë³´ê°€ í¬í•¨ë˜ì§€ ì•Šì•˜ëŠ”ê°€? (ìˆ˜ë ¹ ì¼ì •ë§Œ í¬í•¨í•´ì•¼ í•¨)



## 9. ê°€ê²© ì¶”ì¶œ ì˜ˆì‹œ (ì¤‘ìš”)

### ë²ˆí˜¸ êµ¬ë¶„ ì˜ˆì‹œ (ìµœìš°ì„ ):
- ì…ë ¥: "1ï¸âƒ£í”Œë ˆì¸ë§› ìš”ê±°íŠ¸ 1ê³½ : 5,900ì›\n2ï¸âƒ£ë”¸ê¸°ë§› ìš”ê±°íŠ¸ 1ê³½ : 5,900ì›"
  ê²°ê³¼: 2ê°œ ìƒí’ˆ ì¶”ì¶œ - "í”Œë ˆì¸ë§› ìš”ê±°íŠ¸" 5,900ì›, "ë”¸ê¸°ë§› ìš”ê±°íŠ¸" 5,900ì›
  ì„¤ëª…: ë²ˆí˜¸ êµ¬ë¶„ì´ ìˆìœ¼ë¯€ë¡œ ê°€ê²©ì´ ê°™ì•„ë„ 2ê°œ ìƒí’ˆ

- ì…ë ¥: "â‘ ìƒê±°ë‚˜ì˜¤ë ˆ 1ë´‰ 3,000ì› â‘¡ê¹€ í¬íŠ¸íŒ” 1ë´‰ 3,000ì› â‘¢ì°¸ê¹€ ë‹¨í‰ 1ë´‰ 3,000ì›"
  ê²°ê³¼: 3ê°œ ìƒí’ˆ ëª¨ë‘ ì¶”ì¶œ (ê°ê° 3,000ì›)
  ì„¤ëª…: ë²ˆí˜¸ êµ¬ë¶„ì´ ìˆìœ¼ë¯€ë¡œ ëª¨ë‘ ë³„ê°œ ìƒí’ˆ

### ë°˜ë°•ìŠ¤ ì˜ˆì‹œ:
- ì…ë ¥: "ìº ë²¨í¬ë„ 1ë°•ìŠ¤ 8ì†¡ì´ 22,000ì›\në°˜ë°•ìŠ¤ 4ì†¡ì´ 11,500ì›"
  ê²°ê³¼: 2ê°œ ìƒí’ˆ - "ìº ë²¨í¬ë„ 1ë°•ìŠ¤ 8ì†¡ì´" 22,000ì›, "ìº ë²¨í¬ë„ ë°˜ë°•ìŠ¤ 4ì†¡ì´" 11,500ì›
  ì„¤ëª…: 1ë°•ìŠ¤ì™€ ë°˜ë°•ìŠ¤ëŠ” í•­ìƒ ë³„ê°œ ìƒí’ˆ

### ì˜¬ë°”ë¥¸ ê°€ê²© ì¶”ì¶œ ì˜ˆì‹œ:
- ì…ë ¥: "ë°°ì¶”ê¹€ì¹˜2kg,ì‚¬ì „ì˜ˆì•½ê°€ : 14,800ì›(18,000ì›)"
  ê²°ê³¼: ì¶”ì¶œ 14,800ì› (ì‚¬ì „ì˜ˆì•½ê°€ê°€ íŒë§¤ê°€), ì œì™¸ 18,000ì› (ê´„í˜¸ ì•ˆ ì›ê°€)

- ì…ë ¥: "ì„ë°•ì§€1kg,ì‚¬ì „ì˜ˆì•½ê°€ : 5,980ì›(8,500ì›)"
  ê²°ê³¼: ì¶”ì¶œ 5,980ì› (ì‚¬ì „ì˜ˆì•½ê°€ê°€ íŒë§¤ê°€), ì œì™¸ 8,500ì› (ê´„í˜¸ ì•ˆ ì›ê°€)

- ì…ë ¥: "7,000ì›ì—ì„œ 4,900ì›ìœ¼ë¡œ í• ì¸"
  ê²°ê³¼: ì¶”ì¶œ 4,900ì› (í• ì¸ í›„ íŒë§¤ê°€), ì œì™¸ 7,000ì› (í• ì¸ ì „ ì›ê°€)

### ë™ì¼ ìš©ëŸ‰ í• ì¸ ê´€ê³„ ì˜ˆì‹œ:
- ì…ë ¥: "ë§¥ë°˜ì„ ì˜¤ì§•ì–´ 1ë´‰ì§€(150g) 10,000ì›\n150g 8,500ì›"
  ê²°ê³¼: 1ê°œ ìƒí’ˆ "ë§¥ë°˜ì„ ì˜¤ì§•ì–´ 150g" 8,500ì› (í• ì¸ê°€ ì ìš©, ì¤‘ë³µ ì œê±°)

- ì…ë ¥: "í”„ë¦¬ë¯¸ì—„ ì‚¬ê³¼ 1ë°•ìŠ¤(10ê°œ) 15,000ì›\n10ê°œ 12,000ì›"
  ê²°ê³¼: 1ê°œ ìƒí’ˆ "í”„ë¦¬ë¯¸ì—„ ì‚¬ê³¼ 10ê°œ" 12,000ì› (í• ì¸ê°€ ì ìš©)

### íŠ¹ìˆ˜ í™”ì‚´í‘œ í• ì¸ ê´€ê³„ ì˜ˆì‹œ:
- ì…ë ¥: "ë¯¸ë‹ˆê¸€ë¡œìš° íŒŒì¸ 1í†µ-->> 6.000ì›ğŸ‘‰ğŸ‘‰4,500ì›"
  ê²°ê³¼: 1ê°œ ìƒí’ˆ "ë¯¸ë‹ˆê¸€ë¡œìš° íŒŒì¸ 1í†µ" 4,500ì› (í• ì¸ê°€ ì ìš©)

- ì…ë ¥: "ë‹¬ì½¤í•œ í† ë§ˆí†  1ë°•ìŠ¤--> 8.000ì›â†’6,500ì›"
  ê²°ê³¼: 1ê°œ ìƒí’ˆ "ë‹¬ì½¤í•œ í† ë§ˆí†  1ë°•ìŠ¤" 6,500ì› (í• ì¸ê°€ ì ìš©)

### ì„¸íŠ¸ ìƒí’ˆ ë‹¨ê°€ í‘œì‹œ ì˜ˆì‹œ:
- ì…ë ¥: "ğŸ§¨ì¥ì–¸ë‹ˆ 1ê°œ 625ì›\nğŸ’ì¥ì–¸ë‹ˆ ê³µêµ¬ê°€ 1set 4ë³‘ 2,500ì›"
  ê²°ê³¼: 1ê°œ ìƒí’ˆ "í˜ë¦¬ì— ë ˆëª¬ 4ê°œì… 1ì„¸íŠ¸" 2,500ì›
  ì„¤ëª…: 625Ã—4=2,500ì´ë¯€ë¡œ 1ê°œ ê°€ê²©ì€ ë‹¨ê°€ í‘œì‹œ, ì„¸íŠ¸ë§Œ ì¶”ì¶œ

- ì…ë ¥: "ë‚±ê°œ 1,000ì›\n10ê°œì… 1ë°•ìŠ¤ 10,000ì›"
  ê²°ê³¼: 1ê°œ ìƒí’ˆ "ìƒí’ˆëª… 10ê°œì… 1ë°•ìŠ¤" 10,000ì›
  ì„¤ëª…: 1,000Ã—10=10,000ì´ë¯€ë¡œ ë‚±ê°œëŠ” ì°¸ê³  ì •ë³´, ë°•ìŠ¤ë§Œ ì¶”ì¶œ

## 9. ìƒí’ˆëª… ë‹¨ìœ„ ìš°ì„ ìˆœìœ„ ë° ê´„í˜¸ ì²˜ë¦¬ ì˜ˆì‹œ

### ë‹¨ìœ„ í‘œì‹œ ê·œì¹™ (ì„¸íŠ¸/ë¬¶ìŒ ë³´ì¡´):
- ì˜ëª»ëœ ì˜ˆ (ì„¸íŠ¸ ëˆ„ë½): "1ì„¸íŠ¸/ 4ì•Œ" â†’ "í™ë¡œ í–‡ ì‚¬ê³¼ 4ì•Œ"
- ì˜¬ë°”ë¥¸ ì˜ˆ (ì„¸íŠ¸ ë³´ì¡´): "1ì„¸íŠ¸/ 4ì•Œ" â†’ "í™ë¡œ í–‡ ì‚¬ê³¼ 1ì„¸íŠ¸ 4ì•Œ"

- ì˜ëª»ëœ ì˜ˆ (ë¬¶ìŒ ëˆ„ë½): "2ë¬¶ìŒ 8ê°œ" â†’ "ìƒí’ˆëª… 8ê°œ"
- ì˜¬ë°”ë¥¸ ì˜ˆ (ë¬¶ìŒ ë³´ì¡´): "2ë¬¶ìŒ 8ê°œ" â†’ "ìƒí’ˆëª… 2ë¬¶ìŒ 8ê°œ"

- ì˜ëª»ëœ ì˜ˆ (ë„ˆë¬´ ë§ì€ ë‹¨ìœ„): "ì—¬ìì• ì„ë¥˜ 70ml*30í¬*2ë°•ìŠ¤ 1ì„¸íŠ¸"
- ì˜¬ë°”ë¥¸ ì˜ˆ (ì¤‘ìš”ë„ ìˆœ ì„ ë³„): "ì—¬ìì• ì„ë¥˜ 1ì„¸íŠ¸ 2ë°•ìŠ¤"

### ê´„í˜¸ ì²˜ë¦¬ (ì¤‘ìš” ì •ë³´ ë³´ì¡´):
- ì˜ëª»ëœ ì˜ˆ (ê´„í˜¸ ê¸°í˜¸ í¬í•¨): "ë¯¼ì–´íšŒ(êµ­ë‚´ì‚°)200g(í™œì–´)"
- ì˜¬ë°”ë¥¸ ì˜ˆ (ì„ íƒì  ì²˜ë¦¬): "ë¯¼ì–´íšŒ 200g í™œì–´" (í™œì–´ëŠ” ìƒíƒœì •ë³´ì´ë¯€ë¡œ ë³´ì¡´, êµ­ë‚´ì‚°ì€ ì œê±°)

- ì˜ëª»ëœ ì˜ˆ: "ë¬´í•­ìƒì œ í•œìš°êµ­ê±°ë¦¬(ë©ì–´ë¦¬) 300g"
- ì˜¬ë°”ë¥¸ ì˜ˆ: "ë¬´í•­ìƒì œ í•œìš°êµ­ê±°ë¦¬ ë©ì–´ë¦¬ 300g" (ë¶€ìœ„ì •ë³´ ë³´ì¡´)

- ì˜ëª»ëœ ì˜ˆ: "ì™„ìˆ™í† ë§ˆí† (ìœ ê¸°ë†) 800g"
- ì˜¬ë°”ë¥¸ ì˜ˆ: "ì™„ìˆ™í† ë§ˆí†  ìœ ê¸°ë† 800g" (í’ˆì§ˆì •ë³´ ë³´ì¡´)

- ê³¼ì¼ í¬ê¸° ë³´ì¡´ ì˜ˆì‹œ:
  - ì˜ëª»ëœ ì˜ˆ: "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“1ë°•ìŠ¤(4ìˆ˜)2KG" â†’ "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“ 1ë°•ìŠ¤ 2KG"
  - ì˜¬ë°”ë¥¸ ì˜ˆ: "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“1ë°•ìŠ¤(4ìˆ˜)2KG" â†’ "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“ 1ë°•ìŠ¤ 4ìˆ˜ 2KG"

- ì˜ëª»ëœ ì˜ˆ: "ê³ ê¸‰ ì•¼ì±„ ì²­ê²½ì±„ 1ë´‰ì§€(200g ë‚´ì™¸)"
- ì˜¬ë°”ë¥¸ ì˜ˆ: "ê³ ê¸‰ ì•¼ì±„ ì²­ê²½ì±„ 1ë´‰ì§€"


### ì¤‘ë³µ í‚¤ì›Œë“œ ì œê±°:
- ì˜ëª»ëœ ì˜ˆ (ì¤‘ë³µ ë‹¨ì–´): "ìœ ê¸°ë† í† ë§ˆí†  ì™„ìˆ™í† ë§ˆí†  ìœ ê¸°ë† 800g"
- ì˜¬ë°”ë¥¸ ì˜ˆ (ì¤‘ë³µ ì œê±°): "ìœ ê¸°ë† ì™„ìˆ™í† ë§ˆí†  800g"

- ì˜ëª»ëœ ì˜ˆ (í¬í•¨ ê´€ê³„ ì¤‘ë³µ): "êµ­ë‚´ì‚° í•œìš° êµ­ë‚´ì‚° ë“±ì‹¬"
- ì˜¬ë°”ë¥¸ ì˜ˆ (ì¤‘ë³µ ì •ë¦¬): "êµ­ë‚´ì‚° í•œìš° ë“±ì‹¬"

### ê¸°íƒ€ ê¸ˆì§€ ì‚¬í•­
- ìƒí’ˆëª…ì— ê´„í˜¸ ê¸°í˜¸ () í¬í•¨ (ê´„í˜¸ ê¸°í˜¸ëŠ” ì œê±°í•˜ë˜, ì¤‘ìš”í•œ ë‚´ìš©ì€ ë³´ì¡´í•´ì•¼ í•¨)
  - ì˜ëª»ëœ ì˜ˆ: "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“(4ìˆ˜)" (ê´„í˜¸ ê¸°í˜¸ í¬í•¨)
  - ì˜¬ë°”ë¥¸ ì˜ˆ: "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“ 4ìˆ˜" (ê´„í˜¸ ê¸°í˜¸ ì œê±°, í¬ê¸° ì •ë³´ ë³´ì¡´)

- ìƒí’ˆëª…ì— ì¤‘ë³µ í‚¤ì›Œë“œ í¬í•¨ (ìœ ê¸°ë† í† ë§ˆí†  ì™„ìˆ™í† ë§ˆí†  â†’ ìœ ê¸°ë† ì™„ìˆ™í† ë§ˆí† )
- 3ê°œ ì´ìƒì˜ ë‹¨ìœ„ í‘œì‹œ (ë°•ìŠ¤>ì„¸íŠ¸>ìˆ˜ëŸ‰>ìš©ëŸ‰ ìˆœìœ¼ë¡œ ìµœëŒ€ 2ê°œë§Œ)
- ê´„í˜¸ ì•ˆ ê°€ê²©ì„ íŒë§¤ê°€ë¡œ ì¶”ì¶œ
- ì‚¬ì „ì˜ˆì•½ê°€/ì˜ˆì•½ê°€ë¥¼ ë¬´ì‹œí•˜ê³  ê´„í˜¸ ì•ˆ ê°€ê²© ì„ íƒ
- pickupInfoì— ê°€ê²© ì •ë³´ í¬í•¨ ("ì‚¬ì „ì˜ˆì•½ê°€ 43,500ì›" ê°™ì€ ê°€ê²© ì •ë³´ ê¸ˆì§€)
- "í•œë°•ìŠ¤", "í•œìƒì" ê·¸ëŒ€ë¡œ ì‚¬ìš©
- ìˆ˜ëŸ‰ë³„ ê°€ê²© ì°¨ì´ ìƒí’ˆì— ì¤‘ëŸ‰/ìš©ëŸ‰ ë‹¨ìœ„ í¬í•¨
- í• ì¸ ê°€ê²©ì„ ì—¬ëŸ¬ ìƒí’ˆìœ¼ë¡œ ë¶„ë¦¬
- ê°€ê²©ì´ ìˆëŠ”ë° productsê°€ ë¹ˆ ë°°ì—´
`;

      const prompt = `
ë‹¤ìŒ í…ìŠ¤íŠ¸ì—ì„œ ìƒí’ˆ ì •ë³´ë¥¼ ìœ„ ê·œì¹™ê³¼ í˜•ì‹ì— ë§ì¶° JSONìœ¼ë¡œ ì¶”ì¶œí•´ì£¼ì„¸ìš”:

${content}`;

      const requestBody = {
        systemInstruction: {
          parts: [{
            text: systemInstructions
          }]
        },
        contents: [{
          parts: [{
            text: prompt
          }]
        }],
        // âœ… JSON ì‘ë‹µ ê°•ì œ ì„¤ì • (responseSchema ì„ì‹œ ì œê±°)
        generationConfig: {
          response_mime_type: "application/json",
          temperature: 0.3,
          thinkingConfig: {
            thinkingBudget: 0
          }
        }
      };

      const response = await fetch(aiEndpoint, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(requestBody)
      });

      if (!response.ok) {
        throw new Error(`AI API HTTP error: ${response.status} ${response.statusText}`);
      }

      const aiResponse = await response.json();

      // AI ì‘ë‹µ íŒŒì‹±
      const candidates = aiResponse.candidates;
      if (!candidates || candidates.length === 0) {
        console.error("[AI ë¶„ì„] AI ì‘ë‹µì— candidatesê°€ ì—†ìŒ:", JSON.stringify(aiResponse).substring(0, 500));
        throw new Error("AI response has no candidates");
      }

      const content_parts = candidates[0].content;
      if (!content_parts || !content_parts.parts || content_parts.parts.length === 0) {
        console.error("[AI ë¶„ì„] AI ì‘ë‹µ contentê°€ ë¹„ì–´ìˆìŒ:", JSON.stringify(candidates[0]).substring(0, 500));
        throw new Error("AI response content is empty");
      }

      const textContent = content_parts.parts[0].text;
      if (!textContent) {
        console.error("[AI ë¶„ì„] AI ì‘ë‹µ textê°€ ì—†ìŒ:", JSON.stringify(content_parts).substring(0, 500));
        throw new Error("AI response text is missing");
      }

      console.log("[AI ë¶„ì„] AI ì‘ë‹µ ë°›ìŒ:", textContent.substring(0, 200) + "...");

      // response_schemaê°€ ìˆìœ¼ë¯€ë¡œ ê°„ë‹¨í•œ íŒŒì‹±ë§Œ í•„ìš”
      let parsedResult;
      try {
        // response_schemaë¡œ ì¸í•´ AIê°€ ìˆœìˆ˜ JSONë§Œ ë°˜í™˜
        parsedResult = JSON.parse(textContent);
      } catch (parseError) {
        console.error("[AI ë¶„ì„] JSON íŒŒì‹± ì‹¤íŒ¨:", parseError.message);
        console.error("[AI ë¶„ì„] AI ì‘ë‹µ ê¸¸ì´:", textContent.length);
        console.error("[AI ë¶„ì„] íŒŒì‹± ì‹œë„í•œ í…ìŠ¤íŠ¸ (ì²˜ìŒ 1000ì):", textContent.substring(0, 1000));
        console.error("[AI ë¶„ì„] íŒŒì‹± ì‹œë„í•œ í…ìŠ¤íŠ¸ (ë§ˆì§€ë§‰ 500ì):", textContent.substring(Math.max(0, textContent.length - 500)));

        // JSON ìœ íš¨ì„± ê²€ì‚¬: ì¤‘ê´„í˜¸ ê· í˜• í™•ì¸
        const openBraces = (textContent.match(/{/g) || []).length;
        const closeBraces = (textContent.match(/}/g) || []).length;
        const openBrackets = (textContent.match(/\[/g) || []).length;
        const closeBrackets = (textContent.match(/\]/g) || []).length;

        console.error("[AI ë¶„ì„] ì¤‘ê´„í˜¸ ê· í˜• - ì—´ë¦¼:", openBraces, "ë‹«í˜:", closeBraces);
        console.error("[AI ë¶„ì„] ëŒ€ê´„í˜¸ ê· í˜• - ì—´ë¦¼:", openBrackets, "ë‹«í˜:", closeBrackets);

        // ë°±ì—… 1: ë§ˆí¬ë‹¤ìš´ í˜•ì‹ ì²´í¬
        try {
          const jsonMatch = textContent.match(/```json\n?([\s\S]*?)\n?```/);
          if (jsonMatch && jsonMatch[1]) {
            console.log("[AI ë¶„ì„] ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì—ì„œ JSON ì¶”ì¶œ ì‹œë„");
            parsedResult = JSON.parse(jsonMatch[1]);
          } else {
            throw parseError;
          }
        } catch (markdownError) {
          // ë°±ì—… 2: JSON ë¬¸ìì—´ ì •ë¦¬ ì‹œë„
          try {
            console.log("[AI ë¶„ì„] JSON ë¬¸ìì—´ ì •ë¦¬ ì‹œë„");
            let cleanedJson = textContent.trim();

            // ë¶ˆì™„ì „í•œ JSON ì™„ì„± ì‹œë„
            if (openBraces > closeBraces) {
              const missingBraces = openBraces - closeBraces;
              cleanedJson += '}'.repeat(missingBraces);
              console.log("[AI ë¶„ì„] ëˆ„ë½ëœ ì¤‘ê´„í˜¸", missingBraces, "ê°œ ì¶”ê°€");
            }
            if (openBrackets > closeBrackets) {
              const missingBrackets = openBrackets - closeBrackets;
              cleanedJson += ']'.repeat(missingBrackets);
              console.log("[AI ë¶„ì„] ëˆ„ë½ëœ ëŒ€ê´„í˜¸", missingBrackets, "ê°œ ì¶”ê°€");
            }

            parsedResult = JSON.parse(cleanedJson);
          } catch (finalError) {
            console.error("[AI ë¶„ì„] ëª¨ë“  íŒŒì‹± ì‹œë„ ì‹¤íŒ¨:", finalError.message);
            // AIê°€ í…ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•œ ê²½ìš° ê¸°ë³¸ê°’ ë°˜í™˜
            return getDefaultProduct("JSON íŒŒì‹± ì˜¤ë¥˜ (response_schema ì ìš©ë¨)");
          }
        }
      }

      // ì‘ë‹µ ê²€ì¦ ë° ì •ë¦¬
      if (!parsedResult) {
        console.error("[AI ë¶„ì„] ì˜ˆìƒí•˜ì§€ ëª»í•œ í˜•ì‹ì˜ AI ì‘ë‹µ:", parsedResult);
        return getDefaultProduct("ì˜ëª»ëœ AI ì‘ë‹µ í˜•ì‹");
      }

      // ìƒˆë¡œìš´ í˜•ì‹ ì²˜ë¦¬: multipleProducts ì²´í¬
      if (parsedResult.multipleProducts === true) {
        console.log(`[AI ë¶„ì„] multipleProducts=true, products ê°œìˆ˜: ${parsedResult.products?.length}`);

        // ì—¬ëŸ¬ ìƒí’ˆì¸ ê²½ìš°
        if (!Array.isArray(parsedResult.products) || parsedResult.products.length === 0) {
          console.warn("[AI ë¶„ì„] AIê°€ ìƒí’ˆì„ ì¶”ì¶œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ê¸°ë³¸ ìƒí’ˆ ë°˜í™˜.", parsedResult);
          return getDefaultProduct("AIê°€ ì—¬ëŸ¬ ìƒí’ˆì„ ê°ì§€í–ˆì§€ë§Œ ìœ íš¨í•œ ìƒí’ˆì„ ì¶”ì¶œí•˜ì§€ ëª»í•¨");
        }

        // AIê°€ ë°˜í™˜í•œ ì›ë³¸ titleë“¤ í™•ì¸
        parsedResult.products.forEach((p, i) => {
          console.log(`  [${i}] "${p.title}" (type: ${typeof p.title})`);
        });

        const validProducts = parsedResult.products
          .filter(product => {
            // í•„ìˆ˜ í•„ë“œ ì²´í¬ - ê°œì„ ëœ ê²€ì¦ ë¡œì§
            if (!product.title) {
              console.log(`[AI ë¶„ì„ ê²€ì¦] titleì´ ì—†ìŒ - product:`, JSON.stringify(product).substring(0, 200));
              return false;
            }
            if (typeof product.title !== "string") {
              console.log(`[AI ë¶„ì„ ê²€ì¦] titleì´ ë¬¸ìì—´ì´ ì•„ë‹˜ - type: ${typeof product.title}, value:`, product.title);
              return false;
            }
            const trimmedTitle = product.title.trim();
            if (trimmedTitle.length === 0) {
              console.log(`[AI ë¶„ì„ ê²€ì¦] titleì´ ë¹ˆ ë¬¸ìì—´ - ì›ë³¸: "${product.title}"`);
              return false;
            }
            // ê¸°ë³¸ê°’ ì²´í¬ - "ì£¼ë¬¸ ì–‘ì‹ í™•ì¸ í•„ìš”"ê°€ í¬í•¨ëœ ê²½ìš° ê²½ê³ 
            if (trimmedTitle.includes("ì£¼ë¬¸ ì–‘ì‹ í™•ì¸ í•„ìš”")) {
              console.warn(`[AI ë¶„ì„ ê²½ê³ ] ê¸°ë³¸ fallback title ê°ì§€: "${trimmedTitle}"`);
            }
            return true;
          })
          .map((product, index) => {
            // ìƒˆë¡œìš´ í˜•ì‹ì˜ ìƒí’ˆ ì •ë¦¬
            // ê´„í˜¸ ê¸°í˜¸ë§Œ ì œê±°, ë‚´ìš©ì€ ë³´ì¡´
            let cleanTitle = product.title.trim();
            // ê´„í˜¸ ê¸°í˜¸ë§Œ ì œê±°í•˜ê³  ë‚´ìš©ì€ ìœ ì§€
            cleanTitle = cleanTitle.replace(/[()]/g, ' ');
            // ì—°ì†ëœ ê³µë°±ì„ ë‹¨ì¼ ê³µë°±ìœ¼ë¡œ ì •ë¦¬
            cleanTitle = cleanTitle.replace(/\s+/g, ' ').trim();

            return {
              ...product,
              itemNumber: product.itemNumber || (index + 1),
              title: cleanTitle,
              variantType: product.variantType || parsedResult.variantType || "STANDARD"
            };
          });

        console.log(`[AI ë¶„ì„] ${validProducts.length}ê°œ ìƒí’ˆ ì¶”ì¶œ ì™„ë£Œ:`, validProducts.map(p => p.title));
        return validProducts;

      } else if (parsedResult.multipleProducts === false) {
        // ë‹¨ì¼ ìƒí’ˆì¸ ê²½ìš° - products ë°°ì—´ì—ì„œ ì²« ë²ˆì§¸ ìƒí’ˆ ì¶”ì¶œ
        // ë‹¨ì¼ ìƒí’ˆë„ products ë°°ì—´ì— ìˆì„ ìˆ˜ ìˆìŒ
        let singleProductData;
        if (parsedResult.products && Array.isArray(parsedResult.products) && parsedResult.products.length > 0) {
          console.log(`[AI ë¶„ì„] products ë°°ì—´ì—ì„œ ë‹¨ì¼ ìƒí’ˆ ì¶”ì¶œ`);
          singleProductData = parsedResult.products[0];
        } else {
          // ì´ì „ í˜•ì‹ í˜¸í™˜ì„± - ë£¨íŠ¸ì— ë°”ë¡œ ìƒí’ˆ ì •ë³´ê°€ ìˆëŠ” ê²½ìš°
          console.log(`[AI ë¶„ì„] ë£¨íŠ¸ ë ˆë²¨ì—ì„œ ë‹¨ì¼ ìƒí’ˆ ì •ë³´ ì¶”ì¶œ`);
          singleProductData = parsedResult;
        }

        // title ê²€ì¦
        if (!singleProductData.title) {
          console.log(`[AI ë¶„ì„ ê²€ì¦] ë‹¨ì¼ ìƒí’ˆ titleì´ ì—†ìŒ - singleProductData:`, JSON.stringify(singleProductData).substring(0, 300));
          return getDefaultProduct("ìƒí’ˆ ì œëª© ì—†ìŒ");
        }
        if (typeof singleProductData.title !== "string") {
          console.log(`[AI ë¶„ì„ ê²€ì¦] ë‹¨ì¼ ìƒí’ˆ titleì´ ë¬¸ìì—´ì´ ì•„ë‹˜ - type: ${typeof singleProductData.title}, value:`, singleProductData.title);
          return getDefaultProduct("ìƒí’ˆ ì œëª© íƒ€ì… ì˜¤ë¥˜");
        }
        const trimmedTitle = singleProductData.title.trim();
        if (trimmedTitle.length === 0) {
          console.log(`[AI ë¶„ì„ ê²€ì¦] ë‹¨ì¼ ìƒí’ˆ titleì´ ë¹ˆ ë¬¸ìì—´ - ì›ë³¸: "${singleProductData.title}"`);
          return getDefaultProduct("ìƒí’ˆ ì œëª© ë¹ˆ ë¬¸ìì—´");
        }
        // ê¸°ë³¸ê°’ ì²´í¬
        if (trimmedTitle.includes("ì£¼ë¬¸ ì–‘ì‹ í™•ì¸ í•„ìš”")) {
          console.warn(`[AI ë¶„ì„ ê²½ê³ ] ë‹¨ì¼ ìƒí’ˆì—ì„œ ê¸°ë³¸ fallback title ê°ì§€: "${trimmedTitle}"`);
        }

        // ê´„í˜¸ ê¸°í˜¸ë§Œ ì œê±°, ë‚´ìš©ì€ ë³´ì¡´
        let cleanTitle = singleProductData.title.trim();
        // ê´„í˜¸ ê¸°í˜¸ë§Œ ì œê±°í•˜ê³  ë‚´ìš©ì€ ìœ ì§€
        cleanTitle = cleanTitle.replace(/[()]/g, ' ');
        // ì—°ì†ëœ ê³µë°±ì„ ë‹¨ì¼ ê³µë°±ìœ¼ë¡œ ì •ë¦¬
        cleanTitle = cleanTitle.replace(/\s+/g, ' ').trim();

        // ë‹¨ì¼ ìƒí’ˆì„ ë°°ì—´ë¡œ ë°˜í™˜
        const singleProduct = {
          ...singleProductData,
          itemNumber: singleProductData.itemNumber || 1,
          title: cleanTitle,
          variantType: singleProductData.variantType || parsedResult.variantType || "STANDARD",
          postTime: singleProductData.postTime || postTimeWithWeekday,
          order_needs_ai: false,
          order_needs_ai_reason: null
        };

        console.log(`[AI ë¶„ì„] order_needs_ai: ${singleProduct.order_needs_ai}, reason: ${singleProduct.order_needs_ai_reason}`);
        return [singleProduct];

      } else {
        // ì´ì „ í˜•ì‹ ì§€ì› (í•˜ìœ„ í˜¸í™˜ì„±) ë˜ëŠ” multipleProducts í•„ë“œê°€ ì—†ëŠ” ê²½ìš°
        console.log(`[AI ë¶„ì„] multipleProducts í•„ë“œ ì—†ìŒ - ì´ì „ í˜•ì‹ìœ¼ë¡œ ì²˜ë¦¬`);

        // AIê°€ ë°°ì—´ì„ ì§ì ‘ ë°˜í™˜í•œ ê²½ìš° ì²˜ë¦¬
        if (Array.isArray(parsedResult)) {
          console.log(`[AI ë¶„ì„] AIê°€ ë°°ì—´ì„ ì§ì ‘ ë°˜í™˜ - productsë¡œ ì²˜ë¦¬`);
          parsedResult = { products: parsedResult };
        }

        console.log(`[AI ë¶„ì„] parsedResult êµ¬ì¡°:`, Object.keys(parsedResult));

        if (!parsedResult.products) {
          console.error("[AI ë¶„ì„] products í•„ë“œê°€ ì—†ìŒ. ì „ì²´ ì‘ë‹µ:", JSON.stringify(parsedResult).substring(0, 500));
          return getDefaultProduct("products í•„ë“œ ì—†ìŒ");
        }

        // ìƒí’ˆì´ ì—†ê±°ë‚˜ ë¹ˆ ë°°ì—´ì¸ ê²½ìš°
        if (!Array.isArray(parsedResult.products) || parsedResult.products.length === 0) {
          console.warn("[AI ë¶„ì„] AIê°€ ìƒí’ˆì„ ì¶”ì¶œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë¹ˆ ë°°ì—´ ë°˜í™˜.", parsedResult);
          return []; // ë¹ˆ ë°°ì—´ ë°˜í™˜
        }

        // ê° ìƒí’ˆ ê²€ì¦ ë° ì •ë¦¬
        const validProducts = parsedResult.products
          .filter(product => {
            // í•„ìˆ˜ í•„ë“œ ì²´í¬ - ê°œì„ ëœ ê²€ì¦ ë¡œì§
            if (!product.title) {
              console.log(`[AI ë¶„ì„ ê²€ì¦] titleì´ ì—†ìŒ - product:`, JSON.stringify(product).substring(0, 200));
              return false;
            }
            if (typeof product.title !== "string") {
              console.log(`[AI ë¶„ì„ ê²€ì¦] titleì´ ë¬¸ìì—´ì´ ì•„ë‹˜ - type: ${typeof product.title}, value:`, product.title);
              return false;
            }
            const trimmedTitle = product.title.trim();
            if (trimmedTitle.length === 0) {
              console.log(`[AI ë¶„ì„ ê²€ì¦] titleì´ ë¹ˆ ë¬¸ìì—´ - ì›ë³¸: "${product.title}"`);
              return false;
            }
            // ê¸°ë³¸ê°’ ì²´í¬ - "ì£¼ë¬¸ ì–‘ì‹ í™•ì¸ í•„ìš”"ê°€ í¬í•¨ëœ ê²½ìš° ê²½ê³ 
            if (trimmedTitle.includes("ì£¼ë¬¸ ì–‘ì‹ í™•ì¸ í•„ìš”")) {
              console.warn(`[AI ë¶„ì„ ê²½ê³ ] ê¸°ë³¸ fallback title ê°ì§€: "${trimmedTitle}"`);
            }
            return true;
          })
          .map((product, index) => {
            // ğŸ”¥ ìƒí’ˆëª… ê´„í˜¸ ì²˜ë¦¬ ê°œì„  - ê´„í˜¸ ê¸°í˜¸ë§Œ ì œê±°, ë‚´ìš©ì€ ë³´ì¡´
            console.log(`[í›„ì²˜ë¦¬ ìƒí’ˆ] ì›ë³¸ ì œëª©: "${product.title}"`);
            let cleanTitle = product.title.trim();

            // 1. ê´„í˜¸ ê¸°í˜¸ë§Œ ì œê±°í•˜ê³  ë‚´ìš©ì€ ìœ ì§€
            cleanTitle = cleanTitle.replace(/[()]/g, ' ');

            // 2. ì—°ì†ëœ ê³µë°±ì„ ë‹¨ì¼ ê³µë°±ìœ¼ë¡œ ì •ë¦¬
            cleanTitle = cleanTitle.replace(/\s+/g, ' ').trim();

            // 6. ë‚ ì§œ íŒ¨í„´ ì œê±° (ISO í˜•ì‹ë§Œ ì œê±°, [Mì›”Dì¼] ëŒ€ê´„í˜¸ í”½ì—…ë‚ ì§œëŠ” ìœ ì§€)
            cleanTitle = cleanTitle
              .replace(/(?<!\[)\d+ì›”\d+ì¼(?!\])/g, '') // ëŒ€ê´„í˜¸ ì—†ëŠ” 9ì›”4ì¼ í˜•íƒœë§Œ ì œê±°
              .replace(/\d{4}-\d{2}-\d{2}/g, '') // 2025-09-02 ISO í˜•ì‹ ì œê±°
              .replace(/\d{4}\.\d{2}\.\d{2}/g, '') // 2025.09.02 í˜•ì‹ ì œê±°
              .replace(/\d{4}\/\d{2}\/\d{2}/g, '') // 2025/09/02 í˜•ì‹ ì œê±°
              .replace(/\d{2}-\d{2}-\d{2}/g, '') // 25-09-02 í˜•íƒœ ì œê±°
              .replace(/\s+/g, ' ')
              .trim(); // ì—°ì† ê³µë°± ì •ë¦¬

            // 7. ì¤‘ë³µ í‚¤ì›Œë“œ ì œê±° (ë³µí•© í‚¤ì›Œë“œ ë‚´ ì¤‘ë³µ ë‹¨ì–´ ì²˜ë¦¬)
            const words = cleanTitle.split(/\s+/);
            const processedWords = [];
            const seenBaseWords = new Set();

            for (const word of words) {
              const normalizedWord = word.toLowerCase().trim();
              if (!normalizedWord) continue;

              // ê° ë‹¨ì–´ì—ì„œ ë‹¤ë¥¸ ëª¨ë“  ë‹¨ì–´ë“¤ê³¼ ê²¹ì¹˜ëŠ” ë¶€ë¶„ í™•ì¸
              let shouldAdd = true;
              let bestWord = word;

              // í˜„ì¬ ë‹¨ì–´ê°€ ë‹¤ë¥¸ ë‹¨ì–´ì— í¬í•¨ë˜ëŠ”ì§€ í™•ì¸
              for (const otherWord of words) {
                if (word === otherWord) continue;
                const otherNormalized = otherWord.toLowerCase().trim();

                // "í† ë§ˆí† "ê°€ "ì™„ìˆ™í† ë§ˆí† "ì— í¬í•¨ë˜ëŠ” ê²½ìš°, "ì™„ìˆ™í† ë§ˆí† "ë¥¼ ì„ íƒ
                if (otherNormalized.includes(normalizedWord) && otherNormalized !== normalizedWord) {
                  shouldAdd = false;
                  break;
                }

                // "ì™„ìˆ™í† ë§ˆí† "ê°€ "í† ë§ˆí† "ë¥¼ í¬í•¨í•˜ëŠ” ê²½ìš°, "ì™„ìˆ™í† ë§ˆí† "ë¥¼ ì„ íƒ
                if (normalizedWord.includes(otherNormalized) && normalizedWord !== otherNormalized) {
                  bestWord = word;
                }
              }

              // ì´ë¯¸ ì²˜ë¦¬ëœ ë‹¨ì–´ì™€ ì¤‘ë³µë˜ì§€ ì•Šìœ¼ë©´ ì¶”ê°€
              if (shouldAdd && !seenBaseWords.has(normalizedWord)) {
                seenBaseWords.add(normalizedWord);
                processedWords.push(bestWord);
              }
            }

            cleanTitle = processedWords.join(' ').trim();
            console.log(`[í›„ì²˜ë¦¬ ìƒí’ˆ] ìµœì¢… ì •ë¦¬ í›„ ì œëª©: "${cleanTitle}"`);

            // ê¸°ë³¸ê°’ ì„¤ì •
            const variantType = product.variantType || 'STANDARD';

            const cleanProduct = {
              itemNumber: product.itemNumber || (index + 1),
              title: cleanTitle,
              description: product.description || "",
              quantity_text: product.quantity_text || product.quantityText || "1ê°œ",
              keywords: Array.isArray(product.keywords) ? product.keywords : [],
              priceOptions: [],
              pickupInfo: product.pickupInfo || null,
              pickupDate: product.pickupDate || null,
              pickupType: product.pickupType || null,
              productId: product.productId,
              basePrice: product.price,
              quantityText: product.quantityText,
              quantity: product.quantity,
              category: product.category,
              status: product.status,
              tags: product.tags,
              features: product.features,
              stockQuantity: product.stockQuantity,
              postTime: product.postTime || postTimeWithWeekday,
              variantType
            };

            // ê°€ê²© ì˜µì…˜ ì •ë¦¬
            const parsePositiveNumber = (value) => {
              if (typeof value === 'number' && Number.isFinite(value)) {
                return value;
              }
              if (typeof value === 'string') {
                const normalized = value.replace(/[^\d.]/g, '');
                if (normalized.length === 0) {
                  return NaN;
                }
                const parsed = Number(normalized);
                return Number.isFinite(parsed) ? parsed : NaN;
              }
              return NaN;
            };

            const rawPriceOptions = Array.isArray(product.priceOptions)
              ? product.priceOptions
              : Array.isArray(product.price_options)
                ? product.price_options
                : [];

            if (rawPriceOptions.length > 0) {
              cleanProduct.priceOptions = rawPriceOptions
                .map(opt => {
                  if (!opt) return null;

                  const priceValue = parsePositiveNumber(opt.price);
                  if (!Number.isFinite(priceValue) || priceValue <= 0) {
                    return null;
                  }

                  const parsedQuantity = parsePositiveNumber(opt.quantity);
                  const quantityValue = Number.isFinite(parsedQuantity) && parsedQuantity > 0 ? parsedQuantity : 1;

                  const rawMinQuantity = opt.minQuantity ?? opt.min_quantity;
                  const parsedMinQuantity = parsePositiveNumber(rawMinQuantity);
                  const minQuantityValue = Number.isFinite(parsedMinQuantity) && parsedMinQuantity > 0 ? parsedMinQuantity : 1;

                  const unitLabel = opt.unitLabel || opt.unit_label || opt.unit || cleanProduct.quantity_text || '';

                  return {
                    description: opt.description || cleanProduct.quantity_text,
                    price: priceValue,
                    unit: opt.unit || "ì›",
                    quantity: quantityValue,
                    minQuantity: minQuantityValue,
                    unitLabel
                  };
                })
                .filter(opt => opt !== null);
            }

            // ê°€ê²© ì˜µì…˜ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ ì„¤ì •
            if (cleanProduct.priceOptions.length === 0) {
              cleanProduct.priceOptions = [{
                description: cleanProduct.quantity_text,
                price: 0,
                unit: "ì›",
                quantity: 1,
                minQuantity: 1,
                unitLabel: cleanProduct.quantity_text
              }];
            }

            // priceOptionsë¥¼ ê¸°ë°˜ìœ¼ë¡œ basePrice ë° price ì¬ê³„ì‚°
            const priceOptionsForBase = cleanProduct.priceOptions;
            const optMinQuantity = (opt) => typeof opt?.minQuantity === 'number' && opt.minQuantity > 0 ? opt.minQuantity : 1;

            let basePriceOption = priceOptionsForBase
              .filter(opt => opt.quantity === 1 && (opt.minQuantity ?? 1) === 1)
              .sort((a, b) => a.price - b.price)[0];

            if (!basePriceOption) {
              basePriceOption = priceOptionsForBase
                .filter(opt => opt.quantity === 1)
                .sort((a, b) => {
                  const aMin = optMinQuantity(a);
                  const bMin = optMinQuantity(b);
                  if (aMin !== bMin) return aMin - bMin;
                  return a.price - b.price;
                })[0];
            }

            if (!basePriceOption && priceOptionsForBase.length > 0) {
              basePriceOption = priceOptionsForBase[0];
            }

            const resolvedBasePrice = basePriceOption
              ? basePriceOption.price
              : product.price || product.base_price || product.basePrice || 0;

            cleanProduct.basePrice = resolvedBasePrice;
            cleanProduct.price = resolvedBasePrice;
            cleanProduct.base_price = resolvedBasePrice;

            return cleanProduct;
          });

        if (validProducts.length === 0) {
          console.warn("[AI ë¶„ì„] ì²˜ë¦¬ ì™„ë£Œë˜ì—ˆì§€ë§Œ ìœ íš¨í•œ ìƒí’ˆì´ ì¶”ì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¹ˆ ë°°ì—´ ë°˜í™˜");
          return []; // ë¹ˆ ë°°ì—´ ë°˜í™˜
        }

        console.log(`[AI ë¶„ì„] ${validProducts.length}ê°œ ìƒí’ˆ ì¶”ì¶œ ì™„ë£Œ (ì‹œë„ ${attempt}/${MAX_RETRIES}):`, validProducts.map(p => p.title));

        // ì¬ì‹œë„ë¡œ ì„±ê³µí•œ ê²½ìš° ë¡œê¹…
        if (attempt > 1) {
          console.log(`âœ… [AI ì¬ì‹œë„] ${attempt}ë²ˆì§¸ ì‹œë„ì—ì„œ ì„±ê³µ`);
        }

        return validProducts;
      }
    } catch (error) {
      // ì¬ì‹œë„ ë¡œì§
      if (attempt < MAX_RETRIES) {
        console.warn(`[AI ì¬ì‹œë„] ì‹œë„ ${attempt}/${MAX_RETRIES} ì‹¤íŒ¨: ${error.message}`);
        console.warn(`[AI ì¬ì‹œë„] ${RETRY_DELAY}ms í›„ ì¬ì‹œë„...`);
        // ì¬ì‹œë„ ì „ ë”œë ˆì´
        await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));
        continue; // ì¬ì‹œë„
      } else {
        // ëª¨ë“  ì¬ì‹œë„ ì‹¤íŒ¨
        console.error(`[AI ì¬ì‹œë„] ëª¨ë“  ì¬ì‹œë„ ì‹¤íŒ¨ (${MAX_RETRIES}ë²ˆ ì‹œë„): ${error.message}`);
        console.error("[AI ì¬ì‹œë„] ìµœì¢… ì˜¤ë¥˜ ìƒì„¸:", error);
        break; // ì¬ì‹œë„ ë£¨í”„ ì¢…ë£Œ
      }
    }
  } // for ë£¨í”„ ì¢…ë£Œ

  // ëª¨ë“  ì¬ì‹œë„ ì‹¤íŒ¨ ì‹œ ë¹ˆ ë°°ì—´ ë°˜í™˜
  console.warn("[AI ë¶„ì„] ëª¨ë“  ì¬ì‹œë„ ì‹¤íŒ¨, ë¹ˆ ë°°ì—´ì„ ë°˜í™˜í•˜ì—¬ ì˜ëª»ëœ ë°ì´í„° ì €ì¥ ë°©ì§€");
  return [];
}
